<div style="position: relative;"><a href="https://github.com/bonitasoft/bonita-doc/edit/7.10/md/define-who-can-do-what.md"><img style="position: absolute; top: -1px; right: -40px; border: 0; z-index=-100;" src="https://camo.githubusercontent.com/365986a132ccd6a44c23a9169022c0b5c890c387/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"></a></div>
<h1>Define who can do what</h1>
<p>Up to this point, when you execute the process you were acting as a single user (username: <em>walter.bates</em>, password: <em>bpm</em>) who can perform all the user tasks. In a scenario closer to a real life use case, there are different types of users: customers (who can submit claims), employees (who answer claims) and the manager of the user who provides the answer (who is needed to interact with unsatisfied customers).</p>
<p>The first step in the configuration of &quot;who can do what&quot; is to create lanes within our pool. We already have one default lane for the employees. Let's add another one for the customer and one for the manager:</p>
<ol>
<li>
<p>In Bonita Studio, from the palette on the left hand side of the diagram select the <strong>lane</strong> icon</p>
</li>
<li>
<p>Click inside the diagram to add the lane. Do this twice to have a total of three lanes</p>
</li>
<li>
<p>Select the employee lane and click on the down arrow icon to move it, so it is the middle lane</p>
<p><img src="bonita/images/7.10/getting-started-tutorial/define-who-can-do-what/add-and-organize-lanes.gif" alt="Add and organize lanes" title="Add and organize lanes"></p>
</li>
<li>
<p>Select <em>Lane1</em>, go to the <strong>General &gt; Lane</strong> tab, and rename it <em>Customer lane</em></p>
</li>
<li>
<p>Select  <em>Lane2</em>, go to the <strong>General &gt; Lane</strong> tab and rename it <em>Manager lane</em></p>
</li>
<li>
<p>Select the start event <em>Submit claim</em> and move it (via drag and drop) to the <em>Customer lane</em>. Do the same for the task <em>Read the answer and rate it</em></p>
</li>
<li>
<p>Select the <em>Deal with unsatisfied customer</em> task and move it to the <em>Manager lane</em>. Do the same with the end event <em>End client unsatisfied</em></p>
<p><img src="bonita/images/7.10/getting-started-tutorial/define-who-can-do-what/diagrams-with-lanes.png" alt="Diagrams with lanes" title="Diagrams with lanes"></p>
</li>
</ol>
<div class="alert alert-info" role="alert">
<p>A lane is used to group together user tasks that should be done by the same set of users.</p>
</div>
<p>Now we need to define &quot;actors,&quot; one for each lane, and map them to the lane they belong to:</p>
<ol>
<li>
<p>Select the pool</p>
</li>
<li>
<p>Go to <strong>General &gt; Actors</strong></p>
</li>
<li>
<p>Click on the <strong>Add</strong> button</p>
</li>
<li>
<p>Click on the default name of the actor (<em>Actor1</em>) and change it to: <em>Customer actor</em></p>
</li>
<li>
<p>Repeat to create <em>Manager actor</em></p>
</li>
<li>
<p>Select the <em>Customer actor</em> and click on <strong>Set as initiator</strong> button. This will add a flag on this actor to mark it as the one can start the process</p>
<p><img src="bonita/images/7.10/getting-started-tutorial/define-who-can-do-what/add-rename-actors-set-initiator.gif" alt="Add and rename actors, define initiator" title="Add and rename actors, define initiator"></p>
</li>
<li>
<p>Select <em>Customer lane</em> (click on the lane name)</p>
</li>
<li>
<p>Go to <strong>General &gt; Actors</strong> and in the drop down list, select <em>Customer actor</em></p>
</li>
<li>
<p>Do the same for the <em>Manager lane</em> with the <em>Manager actor</em></p>
<p><img src="bonita/images/7.10/getting-started-tutorial/define-who-can-do-what/map-actor-to-lane.gif" alt="Map actor to lane" title="Map actor to lane"></p>
</li>
</ol>
<p>Actor are just identifiers. In order to define the actual user, we need to configure the actors and map them with groups, roles , users, etc of the organization. We will use the Bonita Acme test organization for this example:</p>
<ol>
<li>
<p>In the Bonita Studio tool bar, click on the <strong>Configure</strong> button <img src="bonita/images/7.10/getting-started-tutorial/define-who-can-do-what/configure.png" alt="Configure button icon" title="Configure button icon"></p>
</li>
<li>
<p>Select <em>Employee actor</em></p>
</li>
<li>
<p>Click on the <strong>Groups...</strong> button</p>
</li>
<li>
<p>Unselect <em>/acme</em></p>
</li>
<li>
<p>Select <em>/acme/production/services</em>. We will use this group of users to act as support team in charge of answering claims. In the test organization, two users belong to this group: <em>mauro.zetticci</em> and <em>thomas.wallis</em>. The manager of both users is: <em>michael.morrison</em></p>
</li>
<li>
<p>Click on the <strong>Finish</strong> button</p>
<p><img src="bonita/images/7.10/getting-started-tutorial/define-who-can-do-what/configure-actor-mapping.gif" alt="Configure actor mapping for customer actor" title="Configure actor mapping for customer actor"></p>
</li>
<li>
<p>Select <strong>Customer actor</strong></p>
</li>
<li>
<p>Click on the <strong>Groups...</strong> button</p>
</li>
<li>
<p>Select <em>/acme/hr</em>. We will use this group of users to act as customers who can submit claims. In the test organization, three users belong to this group: <em>walter.bates</em>, <em>helen.kelly</em> and <em>april.sanchez</em></p>
</li>
<li>
<p>Click on the <strong>Finish</strong> button</p>
</li>
<li>
<p>Select <em>Manager actor</em></p>
</li>
<li>
<p>Click on the <strong>Roles...</strong> button</p>
</li>
<li>
<p>Select the <em>member</em> role. All users in the test organization have this role. But this does not really matter as this actor mapping will be override later in our configuration</p>
</li>
<li>
<p>Click on the <strong>Finish</strong> button</p>
</li>
<li>
<p>Click on the <strong>Finish</strong> button to close the configuration window</p>
</li>
</ol>
<p>At this stage, if you try to run the process, you will see that <em>walter.bates</em> can no longer perform the task <em>Review and answer claim</em>. You'll have to logout from the Bonita Portal (click on <strong>Walter Bates</strong> in top right corner and select <strong>Logout</strong>) and log in with <em>mauro.zetticci</em> or <em>thomas.wallis</em> (password: <em>bpm</em>) to be able to view the task. And you need to log back in with <em>walter.bates</em> account to be able to view the task that let you read the provided answer.</p>
<p>Currently the task <em>Read the answer and rate it</em> is available to all users in the group <em>/acme/hr</em>, but it should only be available to the user who started the process (<em>walter.bates</em>). Similarly, the task <em>Deal with unsatisfied customer</em> will be available to everyone when it should only be available to the manager of the user who completed the task <em>Review and answer claim</em>. To address this, we will configure actor filters:</p>
<ol>
<li>
<p>Select the <em>Customer lane</em></p>
</li>
<li>
<p>Go to <strong>General &gt; Actors</strong></p>
</li>
<li>
<p>Click on the <strong>Set...</strong> button next to actor filter</p>
</li>
<li>
<p>From the list, select <em>Initiator</em></p>
</li>
<li>
<p>Click on the <strong>Next</strong> button</p>
</li>
<li>
<p>Set the name: <em>User who submit the claim</em></p>
</li>
<li>
<p>Click on the <strong>Finish</strong> button</p>
<p><img src="bonita/images/7.10/getting-started-tutorial/define-who-can-do-what/configure-initiator-actor-filter.gif" alt="Configure initiator actor filter on Customer lane" title="Configure initiator actor filter on Customer lane"></p>
</li>
<li>
<p>Select <em>Manager lane</em></p>
</li>
<li>
<p>Follow the same steps but select the <em>user-manager</em> actor filter</p>
</li>
<li>
<p>Set the name: <em>Manager of the user who provided answer</em></p>
</li>
<li>
<p>Click on the <strong>Next</strong> button</p>
</li>
<li>
<p>Click on the pencil icon</p>
</li>
<li>
<p>Select <strong>Script</strong> and paste the following Groovy script (it will search for the id of the user who performed the task <em>Review and answer claim</em>):</p>
<pre><code class="language-groovy">import org.bonitasoft.engine.bpm.flownode.ArchivedHumanTaskInstance
import org.bonitasoft.engine.bpm.flownode.ArchivedHumanTaskInstanceSearchDescriptor
import org.bonitasoft.engine.search.SearchOptionsBuilder
import org.bonitasoft.engine.search.SearchResult

def taskName = 'Review and answer claim'

final SearchOptionsBuilder searchOptionsBuilder = new SearchOptionsBuilder(0, 1)
.filter(ArchivedHumanTaskInstanceSearchDescriptor.PARENT_PROCESS_INSTANCE_ID, processInstanceId)
.filter(ArchivedHumanTaskInstanceSearchDescriptor.NAME, taskName).filter(ArchivedHumanTaskInstanceSearchDescriptor.TERMINAL, true)

SearchResult&lt;ArchivedHumanTaskInstance&gt; searchResult = apiAccessor.processAPI.searchArchivedHumanTasks(searchOptionsBuilder.done())

final List&lt;ArchivedHumanTaskInstance&gt; tasks = searchResult.result

tasks.first().executedBy
</code></pre>
</li>
<li>
<p>Click on <strong>OK</strong></p>
</li>
<li>
<p>Click on <strong>Finish</strong></p>
<p><img src="bonita/images/7.10/getting-started-tutorial/define-who-can-do-what/configure-user-manager-actor-filter.gif" alt="Configure user manager actor filter for manager lane" title="Configure user manager actor filter for manager lane"></p>
</li>
</ol>
<p>If you run the process again, only <em>walter.bates</em> should have access to <em>Read the answer and rate it</em> and only <em>michael.morrison</em> should have access to <em>Deal with unsatisfied customer</em> (as he is the manager of both users who can complete the task <em>Review and answer claim</em>).</p>
<p>Now we have a fully customized process that processes data and dispatches tasks to appropriate users. The next step will be to make this process interact with the outside world.</p>
<!-- Generated on Tue Dec 10 2019 12:49:51 GMT+0100 (Paris, Madrid) -->