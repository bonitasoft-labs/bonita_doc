<div style="position: relative;"><a href="https://github.com/bonitasoft/bonita-doc/edit/7.10/md/runtime-monitoring.md"><img style="position: absolute; top: -1px; right: -40px; border: 0; z-index=-100;" src="https://camo.githubusercontent.com/365986a132ccd6a44c23a9169022c0b5c890c387/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"></a></div>
<h1>Bonita Runtime Monitoring</h1>
<p>Discover how to monitor a runtime environment running Bonita</p>
<p>In Community edition, monitoring metrics can be published via 2 channels: JMX and / or Logging file.<br>
In Subscription editions, monitoring metrics can be published via 3 channels: JMX and / or Logging file and / or
a Prometheus endpoint.</p>
<h2>Why monitoring ?</h2>
<p>Monitoring a Production environment is crucial to ensure the runtime is correctly sized and tuned.</p>
<p>Bonita provides a series of technical and Bonita-related metrics to monitor the health of Bonita runtime environment.<br>
Some metrics are enabled by default and cannot be disabled. Some others are optional and can be enabled according to
your needs.</p>
<h2>Glossary</h2>
<p><strong>Work</strong>: a unit piece of code that executes parts of process instances, tasks, BPM elements... and allows the processes to execute forwards.
It executes in a Java thread.</p>
<p><strong>Connector work</strong>: a unit piece of code that specifically executes Bonita connectors.</p>
<p><strong>Work queue</strong>: a queue storing pending works before they are taken by threads for execution.</p>
<p><strong>Metric</strong>: an indicator (generally a numeric value) giving information on the system. They can be technical (number
of running threads on the JVM), or more Bonita-oriented (total number of connectors executed).</p>
<p><strong>Metric Publisher</strong>: a publisher is responsible for exposing the activated metrics. It is a channel on which metrics are published.
Provided metric publishers are JMX (all editions), Log files (all editions), Prometheus (Subscription editions only).</p>
<h2>Which metrics are available?</h2>
<h3>Bonita-related metrics</h3>
<p>Bonita-related metrics are <strong>enabled by default</strong> and cannot be disabled. Here are the provided metrics:</p>
<ul>
<li>The number of currently running works, under the logical key name <strong>bonita.bpmengine.work.running</strong></li>
<li>The number of currently pending works, waiting in the work queue to be treated, under the logical key name <strong>bonita.bpmengine.work.pending</strong></li>
<li>The total number of executed works (since the last start of Bonita runtime), under the logical key name <strong>bonita.bpmengine.work.executed</strong></li>
<li>The number of currently running connector works, under the logical key name <strong>bonita.bpmengine.connector.running</strong></li>
<li>The number of currently pending connector works, waiting in the connector work queue to be treated,
under the logical key name <strong>bonita.bpmengine.connector.pending</strong></li>
<li>The total number of executed connector works (since the last start of Bonita runtime), under the logical key name <strong>bonita.bpmengine.connector.executed</strong></li>
<li>The total number of treated BPM messages (since the last start of Bonita runtime), under the logical key name <strong>bonita.bpmengine.message.executed</strong></li>
</ul>
<h3>Technical metrics</h3>
<p>The following available metrics are <strong>disabled by default</strong> and can be enabled.</p>
<ul>
<li>Several metrics related to JVM memory, under the logical key names <strong>jvm.memory.</strong>* and <strong>jvm.buffer.</strong>*</li>
<li>Several metrics related to JVM threads, under the logical key name <strong>jvm.threads.</strong>*</li>
<li>Several metrics related to JVM garbage collection, under the logical key name <strong>jvm.gc.</strong>*</li>
<li>Several metrics related to Worker / Connector thread pools, under the logical key name <strong>executor.</strong>*</li>
<li>Several metrics related to Hibernate statistics, under the logical key name <strong>hibernate.</strong>*</li>
<li>Several metrics related to Tomcat, under the logical key name <strong>tomcat.</strong>*</li>
</ul>
<h2>Activating specific monitoring metrics</h2>
<p>Retrieve <a href="bonita/7.10/BonitaBPM_platform_setup" ng-click="contentCtrl.goTo($event, 'BonitaBPM_platform_setup', 'update_platform_conf')">current configuration</a> by running:</p>
<pre><code class="language-bash">./setup/setup.sh pull
</code></pre>
<h3>Activating Metrics Publishers</h3>
<p>Edit file <code>./setup/platform_conf/current/platform_engine/bonita-platform-community-custom.properties</code><br>
You will see, in the <code># MONITORING</code> section, a series of properties with their default value:</p>
<pre><code>## MONITORING
## PUBLISHERS = where to publish?
## publish metrics to JMX:
#org.bonitasoft.engine.monitoring.publisher.jmx.enable=true
## periodically print metrics to logs (bonita-related metrics only):
#org.bonitasoft.engine.monitoring.publisher.logging.enable=false
## print to logs every minute by default (in the ISO-8601 duration format):
#org.bonitasoft.engine.monitoring.publisher.logging.step=PT1M
</code></pre>
<p>These are the <strong>metric publishers</strong> that can be activated.<br>
In Community edition, 2 metric publishers are provided:</p>
<ul>
<li>JMX (enabled by default), that allows to use any JMX console to monitor your favorite metrics (except JVM metrics,
as they are already published by the JVM itself by default)</li>
<li>Logging (disabled by default), that regularly prints to standard Bonita log file the Bonita-related metrics. Print interval can
be changed (property <code>org.bonitasoft.engine.monitoring.logging.step</code>).</li>
</ul>
<div class="alert alert-info" role="alert">
<p>To change any value, <strong>uncomment the line by removing the # character</strong>, and change the true / false value.<br>
Then <a href="bonita/7.10/BonitaBPM_platform_setup" ng-click="contentCtrl.goTo($event, 'BonitaBPM_platform_setup', 'update_platform_conf')" class="alert-link">push your configuration changes</a> to database:</p>
<pre><code class="language-bash">./setup/setup.sh push
</code></pre>
<p>Then restart the Tomcat server for the changes to take effect.</p>
</div>
<h3>Activating specific metric indicators</h3>
<p>Edit the same file <code>./setup/platform_conf/current/platform_engine/bonita-platform-community-custom.properties</code></p>
<pre><code>## METRICS = what to publish?
##
## Note: Bonita-related metrics are automatically published.
## They are active by default and cannot be disabled.
##
## publish technical metrics related to Worker / Connector thread pools:
#org.bonitasoft.engine.monitoring.metrics.executors.enable=false
## publish technical metrics related to HIBERNATE statistics
## To activate, simply set property (a few lines above) 'bonita.platform.persistence.generate_statistics=true'
</code></pre>
<p>These are the <strong>metrics</strong> (counters) that can be exposed.<br>
All configurable metrics are disabled by default and can be enabled separately.<br>
They provide information about:</p>
<ul>
<li>Worker / Connector thread pools</li>
<li>Hibernate statistics</li>
</ul>
<p>Each of these metrics provides many different counters to finely understand what is going on.</p>
<div class="alert alert-info" role="alert">
<p>To change any value, <strong>uncomment the line by removing the # character</strong>, and change the true / false value.<br>
Then <a href="bonita/7.10/BonitaBPM_platform_setup" ng-click="contentCtrl.goTo($event, 'BonitaBPM_platform_setup', 'update_platform_conf')" class="alert-link">push your configuration changes</a> to database:</p>
<pre><code class="language-bash">./setup/setup.sh push
</code></pre>
<p>Then restart the Tomcat server for the changes to take effect.</p>
</div>
<h2>Subscription-only monitoring</h2>
<h3>Additional metrics</h3>
<p>Thanks to additional publisher, additional metrics can be published</p>
<p>These metrics provide information about:</p>
<ul>
<li>the running JVM memory</li>
<li>JVM threads</li>
<li>Garbage collection usage</li>
<li>Tomcat counters on sessions, threads, requests, connections...</li>
</ul>
<p>They can be activated by editing file <code>./setup/platform_conf/current/platform_engine/bonita-platform-sp-custom.properties</code></p>
<pre><code>## METRICS = what to publish?
##
## publish metrics related to JVM memory:
#org.bonitasoft.engine.monitoring.metrics.jvm.memory.enable=false
## publish metrics related to JVM Threads:
#org.bonitasoft.engine.monitoring.metrics.jvm.threads.enable=false
## publish metrics related to JVM garbage collection:
#org.bonitasoft.engine.monitoring.metrics.jvm.gc.enable=false
## publish technical metrics related to Tomcat (if in a Tomcat context):
#org.bonitasoft.engine.monitoring.metrics.tomcat.enable=false
</code></pre>
<h3>Prometheus publisher</h3>
<div class="alert alert-info" role="alert">
<p><strong>Note:</strong> For Enterprise, Performance, Efficiency, and Teamwork editions only.</p>
</div>
<p>Prometheus</p>
<p>In addition to these metric publishers, Bonita Subscription editions can also publish to a REST endpoint in the
<a href="https://prometheus.io/docs/instrumenting/exposition_formats/#text-format-example">Prometheus format</a>, that can
easily be consumed by Prometheus and then displayed by graphical tools like Grafana, etc.</p>
<p>To activate Prometheus endpoint in Bonita, simply edit file <code>./setup/platform_conf/current/platform_engine/bonita-platform-sp-custom.properties</code>
and change:</p>
<pre><code># Activate publication of metrics to prometheus:
# com.bonitasoft.engine.plugin.monitoring.prometheus.enable=false
</code></pre>
<p>to</p>
<pre><code># Activate publication of metrics to prometheus:
com.bonitasoft.engine.plugin.monitoring.prometheus.enable=true
</code></pre>
<p>Then <a href="bonita/7.10/BonitaBPM_platform_setup" ng-click="contentCtrl.goTo($event, 'BonitaBPM_platform_setup', 'update_platform_conf')">push your configuration changes</a> to database:</p>
<pre><code class="language-bash">./setup/setup.sh push
</code></pre>
<p>Then restart the Tomcat server for the changes to take effect.</p>
<p>This exposes all activated metrics (see <a href="bonita/7.10/" ng-click="contentCtrl.goTo($event, '', 'activating-specific-metric-indicators')">above</a>) at endpoint:</p>
<pre><code>http://&lt;SERVER_URL&gt;/bonita/metrics
</code></pre>
<p>Use this URL to configure your installed Prometheus configuration in order to record and display the metrics.</p>
<p>Sample extract of exposed Prometheus data:</p>
<pre><code># HELP jvm_buffer_memory_used_bytes An estimate of the memory that the Java virtual machine is using for this buffer pool
# TYPE jvm_buffer_memory_used_bytes gauge
jvm_buffer_memory_used_bytes{id=&quot;direct&quot;,} 565248.0
jvm_buffer_memory_used_bytes{id=&quot;mapped&quot;,} 0.0
# HELP bonita_bpmengine_connector_pending  
# TYPE bonita_bpmengine_connector_pending gauge
bonita_bpmengine_connector_pending{tenant=&quot;1&quot;,} 0.0
# HELP bonita_bpmengine_connector_executed_total  
# TYPE bonita_bpmengine_connector_executed_total counter
bonita_bpmengine_connector_executed_total{tenant=&quot;1&quot;,} 0.0
# HELP bonita_bpmengine_work_running  
# TYPE bonita_bpmengine_work_running gauge
bonita_bpmengine_work_running{tenant=&quot;1&quot;,} 0.0
# HELP jvm_gc_max_data_size_bytes Max size of old generation memory pool
# TYPE jvm_gc_max_data_size_bytes gauge
jvm_gc_max_data_size_bytes 7.16177408E8
# HELP bonita_bpmengine_work_pending  
# TYPE bonita_bpmengine_work_pending gauge
bonita_bpmengine_work_pending{tenant=&quot;1&quot;,} 0.0
# HELP tomcat_servlet_request_max_seconds 
# TYPE tomcat_servlet_request_max_seconds gauge
tomcat_servlet_request_max_seconds{name=&quot;default&quot;,} 0.0
tomcat_servlet_request_max_seconds{name=&quot;dispatcherServlet&quot;,} 0.104
# HELP tomcat_threads_config_max_threads 
# TYPE tomcat_threads_config_max_threads gauge
tomcat_threads_config_max_threads{name=&quot;http-nio-8080&quot;,} 200.0
# HELP tomcat_sessions_expired_sessions_total 
# TYPE tomcat_sessions_expired_sessions_total counter
tomcat_sessions_expired_sessions_total 0.0
# HELP tomcat_sessions_active_max_sessions 
# TYPE tomcat_sessions_active_max_sessions gauge
tomcat_sessions_active_max_sessions 0.0
...
</code></pre>
<!-- Generated on Tue Dec 10 2019 12:49:52 GMT+0100 (Paris, Madrid) -->