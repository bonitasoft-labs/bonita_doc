<div style="position: relative;"><img style="position: absolute; top: -1px; right: -40px; border: 0; z-index=-100;" src="bonita/images/7.3/outOfSupport.png" alt="Out of support"></div>
<h1>Multi-tenancy and tenant configuration</h1>
<div class="alert alert-info" role="alert">
<p><strong>Note:</strong> For Performance edition only.</p>
</div>
<p>This page explains the architecture and configuration of a multi-tenant system using Bonita BPM.</p>
<h2>Platform architecture</h2>
<p>By default, all installations of Bonita BPM create a single tenant. However multi-tenancy is possible with the Performance edition.</p>
<p>Multi-tenancy involves a single software installation, called a <strong>platform</strong>, that can serve multiple independent organizations, called <strong>tenants</strong>.
Each tenant is a separate, self contained configuration for a single client/company.
Artifacts are deployed at tenant level, so a tenant has its own organization (users, groups, roles), processes (apps, cases, trasks), reports, and custom pages.
Data within a tenant are completely isolated. A tenant cannot access data from any other tenant. A user logged in to a tenant cannot access any other tenant.</p>
<p>After the installation of any Bonita BPM version (Community or Subscription), a single default tenant is created and ready for use.</p>
<p><img src="bonita/images/7.3/images-6_0/default_tenant_setup.png" alt="default" title="default"></p>
<p>If you are using the Performance edition, you can create additional tenants, using the Platform API (through Java or REST API).
These tenants are configured with a single database. This illustration shows a platform with three tenants.</p>
<p><img src="bonita/images/7.3/images-6_0/v6tenant.png" alt="multi-tenancy" title="multi-tenancy"></p>
<h2>Platform configuration</h2>
<p>The platform is the part of the system that is common to all tenants.</p>
<p>Before the platform has been initialized, its configuration can be customized in <code>setup/platform_conf/initial</code>. However, in order to modify the configuration on an
installation whose platform has already been initialized, you need to use the <a href="?page=BonitaBPM_platform_setup" ng-click="contentCtrl.goTo($event, 'BonitaBPM_platform_setup')">platform setup tool</a> to retrieve the current
configuration and update the files in <code>setup/platform_conf/current/</code>. Then use the tool again to save your changes into the database.</p>
<p>The <em>engine</em> platform configuration directory is located in sub-folder: <code>current/platform_engine/</code>.<br>
The <em>portal</em> platform configuration directory is located in sub-folder: <code>current/platform_portal/</code>.</p>
<p>There is a separate <em>engine</em> configuration directory for each tenant, located in: <code>current/tenants/&lt;tenant_id&gt;/tenant_engine</code>.<br>
There is a separate <em>portal</em> configuration directory for each tenant, located in: <code>current/tenants/&lt;tenant_id&gt;/tenant_portal</code>.<br>
There is also a default tenant <em>engine</em> configuration directory, located in: <code>current/tenant_template_engine</code>.<br>
There is also a default tenant <em>portal</em> configuration directory, located in: <code>current/tenant_template_portal</code>.</p>
<h2>Tenant creation</h2>
<p>A tenant can be created using the Java PlatformAPI (see the <a href="http://documentation.bonitasoft.com/javadoc/api/7.3/com/bonitasoft/engine/api/PlatformAPI.html" target="_self">Engine Javadoc</a>) or the <a href="?page=platform-api" ng-click="contentCtrl.goTo($event, 'platform-api')">platform REST API</a>.</p>
<p><strong>Note:</strong>
If <a href="?page=define-and-deploy-the-bdm" ng-click="contentCtrl.goTo($event, 'define-and-deploy-the-bdm')">business objects</a> will be deployed in the newly created tenant do not forget to <a href="?page=database-configuration-for-business-data" ng-click="contentCtrl.goTo($event, 'database-configuration-for-business-data')">create the business data database and configure specific data sources</a>.
This must be done for each tenant that will use the <a href="?page=define-and-deploy-the-bdm" ng-click="contentCtrl.goTo($event, 'define-and-deploy-the-bdm')">Business Data</a> feature.</p>
<div class="alert alert-warning" role="alert">
<p><strong>Important</strong><br>
Once a tenant has been created and activated, default theme is not yet loaded.<br>
Therefore, as long as you have not logged in to the new tenant, the login page will miss the default theme.</p>
<p>After the first login, default theme will be loaded and the login page will look as usual.</p>
</div>
<h3>Java PlatformAPI</h3>
<p>The Java PlatformAPI creates the tenant by updating the database and creating configuration based on the tenant template files (in database too).
The following example code uses the Engine Java APIs to create a tenant called &quot;myNewTenantName&quot;:</p>
<pre><code class="language-java">    // Get platform login API using the PlatformAPIAccessor:
    PlatformLoginAPI platformLoginAPI = PlatformAPIAccessor.getPlatformLoginAPI();
    // Log in to the platform:
    PlatformSession platformSession = platformLoginAPI.login(&quot;platformAdmin&quot;, &quot;platform&quot;);
    
    // Get the platform API:
    PlatformAPI platformAPI = PlatformAPIAccessor.getPlatformAPI(platformSession);
    
    // Create a new tenant:
    TenantCreator tenantCreator = new TenantCreator(&quot;myNewTenantName&quot;);
    tenantCreator.setUsername(&quot;install&quot;);
    tenantCreator.setPassword(&quot;install&quot;);
    long tenantId = platformAPI.createTenant(tenantCreator);
    platformAPI.activateTenant(tenantId);
    
    // Log out of the platform:
    platformLoginAPI.logout(platformSession);
</code></pre>
<h3>REST API</h3>
<p>The <a href="?page=platform-api" ng-click="contentCtrl.goTo($event, 'platform-api')">platform REST API</a> is a REST layer around the Java PlatformAPI to create the tenant.</p>
<h2>Tenant access</h2>
<p>A tenant is identified by an id, which is used to log in and to retrieve the tenant. A tenant also has a name. You can use the tenant name to retrieve the tenant id.</p>
<p>To use the newly created tenant:</p>
<pre><code class="language-java">    // use tenant-level api client:
    APIClient apiClient = new APIClient();
    
    // login on the new tenant with the only existing 'technical' user, ...
    apiClient.login(TENANT_ID, &quot;install&quot;, &quot;install&quot;);               // here, replace TENANT_ID by the ID of the tenant you just created above
    
    // ... in order to create other users:
    user = apiClient.getIdentityAPI().createUser(&quot;john&quot;, &quot;bpm&quot;, &quot;John&quot;, &quot;Doe&quot;);
    apiClient.logout();
    
    // now login with the new user:
    apiClient.login(TENANT_ID, &quot;john&quot;, &quot;bpm&quot;);
    
    // retrieve an API to interact with the engine:
    ProcessAPI processApi = apiClient.getProcessAPI();
    // and use the processApi on the new tenant...
    [...]
    
    // Don't forget to logout finally:
    apiClient.logout();
</code></pre>
<h3>Bonita BPM Portal</h3>
<p>In order to access Bonita BPM Portal desktop and mobile application, add the parameter <code>tenant=TENANT_ID</code> (where TENANT_ID is the tenant identifier) in the URL before you login.</p>
<p>Example for Bonita BPM Portal desktop version and tenant 2:<br>
<code>http://localhost:8080/bonita/login.jsp?tenant=2</code></p>
<p>Example for Bonita BPM Portal mobile version and tenant 2:<br>
<code>http://localhost:8080/bonita/mobile/?tenant=2</code></p>
<h3>Bonita APIs</h3>
<p>Use the <a href="http://documentation.bonitasoft.com/javadoc/api/7.3/index.html" target="_self">PlatformAPI</a> to perform operations on tenants.</p>
<p>Example: retrieving a tenant from its name and log into it</p>
<pre><code class="language-java">    // Get platform login API using the PlatformAPIAccessor
    PlatformLoginAPI platformLoginAPI = PlatformAPIAccessor.getPlatformLoginAPI();
    // Log in to the platform
    PlatformSession platformSession = platformLoginAPI.login(&quot;platformAdmin&quot;, &quot;platform&quot;);
    
    // Get the plaform API
    PlatformAPI platformAPI = PlatformAPIAccessor.getPlatformAPI(platformSession);
    // Retrieve your tenant by name
    Tenant tenant = platformAPI.getTenantByName(&quot;myTenant&quot;);
    
    // Log out of the platform
    platformLoginAPI.logout(platformSession);
    
    
    // Log in to the tenant using the APIClient
    APIClient apiClient = new APIClient();
    apiClient.login(tenant.getId(), &quot;install&quot;, &quot;install&quot;);
    
    // Perform some operations on the tenant...
    
    // Log out of the tenant
    apiClient.logout();
</code></pre>
<h2>Pause and resume a tenant</h2>
<p>To perform certain maintenance operations (notably when updating the business data model), you must pause the BPM service of a tenant. The
TenantAdministrationAPI contains the following methods related to pausing a tenant:</p>
<ul>
<li><code>TenantAdministrationAPI.isPaused()</code> returns true if the Tenant BPM service is paused.</li>
<li><code>TenantAdministrationAPI.pause()</code> pauses the tenant BPM service.</li>
<li><code>TenantAdministrationAPI.resume(</code>) resume the tenant BPM service.</li>
</ul>
<p>For example, to resume the service in a tenant:</p>
<pre><code class="language-java">    TenantAdministrationAPI tenantAdministrationAPI = TenantAPIAccessor.getTenantAdministrationAPI(apiSession);
    if (tenantAdministrationAPI.isPaused()) {
        tenantAdministrationAPI.resume();
    }
</code></pre>
<p>While service is paused in a tenant, only the following methods are valid:</p>
<ul>
<li>IdentityAPI method calls</li>
<li>ProfileAPI method calls</li>
<li>themeAPI method calls</li>
<li>TenantAdministrationAPI method calls</li>
</ul>
<p>If you attempt an operation that is not permitted while a tenant is paused, a <code>TenantStatusException</code> is thrown.</p>
<p>You can also pause and resume a tenant using the
<a href="?page=platform-api" ng-click="contentCtrl.goTo($event, 'platform-api')">REST API</a> or <a href="?page=pause-and-resume-bpm-services" ng-click="contentCtrl.goTo($event, 'pause-and-resume-bpm-services')">Bonita BPM Portal</a>.</p>
<!-- Generated on Tue Jun 19 2018 09:27:07 GMT+0200 (Paris, Madrid (heure d’été)) -->