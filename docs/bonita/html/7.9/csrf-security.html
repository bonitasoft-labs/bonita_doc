<div style="position: relative;"><a href="https://github.com/bonitasoft/bonita-doc/edit/7.9/md/csrf-security.md"><img style="position: absolute; top: -1px; right: -40px; border: 0; z-index=-100;" src="https://camo.githubusercontent.com/365986a132ccd6a44c23a9169022c0b5c890c387/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"></a></div>
<h1>CSRF security</h1>
<p>Bonita REST API is secured against Cross-Site Request Forgery (CSRF) attacks.</p>
<p>CSRF (also known as XSRF and Sea-Surf), is an example of a malicious attack on a trusted website.
While the user is authenticated, by being logged on to a trusted website, malicious requests are transmitted without the user knowing, or giving their consent.
For example, by clicking on a link, the user is tricked into performing actions using their ID and privileges, such as giving personal information, bank details, making purchases or payments.
If the targeted end user is an administrator, the entire web application can be compromised.</p>
<h2>Default security setup in Bonita</h2>
<p>In Bonita, since version 7.4.0, the CSRF protection is enabled by default.</p>
<h2>How it works</h2>
<p>To prevent malicious attacks a token is generated server-side when logging in and added to the HTTP session (server-side as well).
A cookie named <code>X-Bonita-API-Token</code> is created (hence, client-side) with the value of the token if the login is successful.
Then for all subsequent REST API calls this token is added to the HTTP request headers.
For each call, the server is checked to verify that the value in the Header is equal to the value stocked in the HTTP session.
If so, the request proceed. Otherwise, this is considered to be an unauthorized access. (HTTP Status 401).</p>
<p>In addition of the cookie, it is also possible to retrieve the token by performing a call to the resource <code>/API/system/session/unusedId</code>. The token is then returned in the headers of the HTTP response.</p>
<p>An attacker cannot retrieve the value of the token unless they can inject some JavaScript (which has been mitigated thanks to our SecurityFilter), to make a call to the resource <code>/API/system/session/unusedId</code>,
get the header <code>X-Bonita-API-Token</code>, and create their own requests.</p>
<h2>Is there an impact on REST API calls?</h2>
<p>If you are using Bonita Portal there is no impact.</p>
<p>If you have developed an external application or some custom pages using the REST API to communicate with bonita, you need to send the <code>X-Bonita-API-Token</code> header in all requests other that GET. There are 2 ways of doing this:</p>
<ul>
<li>
<p>Using the <code>X-Bonita-API-Token</code> cookie:</p>
<ul>
<li>Retrieve the <code>X-Bonita-API-Token</code> cookie value (you can retrieve it once and store it in a variable if you don't want to read the cookie each time you perform a call).</li>
<li>In each API request, add a header named <code>X-Bonita-API-Token</code> whose value is the token.</li>
</ul>
</li>
<li>
<p>Using the session API resource</p>
<ul>
<li>Send an initial request to the session API resource (<code>/API/system/session/unusedId</code>).</li>
<li>Retrieve the <code>X-Bonita-API-Token</code> from the response header and store it.</li>
<li>In all future API requests, add a header named <code>X-Bonita-API-Token</code> containing the stored token.</li>
</ul>
</li>
</ul>
<p>The <code>X-Bonita-API-Token</code> is valid for the whole client session.</p>
<h2>How do I disable it?</h2>
<p>Disabling the CSRF protection is not recommended as it will makes Bonita REST API unprotected from malicious attacks.</p>
<p>But if you need to, the deactivation of the CSRF protection can be done in the file <code>security-config.properties</code> for the whole platform.
The default version of this file is located in <code>setup/platform_conf/initial/platform_portal</code>. In order to change the configuration on an installation whose platform has already been initialized, use the <a href="?page=BonitaBPM_platform_setup" ng-click="contentCtrl.goTo($event, 'BonitaBPM_platform_setup')">platform setup tool</a> to retrieve the current configuration and update the file in <code>setup/platform_conf/current/platform_portal</code>. Then use the tool again to save your changes into to the database.</p>
<p>When CSRF protection is enables, this file contains this line:
<code>security.csrf.enabled true</code></p>
<p>To disable the CSRF protection, edit the configuration file and change the <code>security.csrf.enabled</code> value to <strong>false</strong>.</p>
<h2>How to secure the X-Bonita-API-Token cookie (HTTPS only)?</h2>
<p>You can set the secure flag on the <code>X-Bonita-API-Token</code> cookie to make sure the browser will only transmit the cookie if the page is HTTPS.</p>
<p>Activating the addition of the secure flag can be done in the file <code>security-config.properties</code> for the whole platform.
The default version of this file is located in <code>setup/platform_conf/initial/platform_portal</code>. In order to change the configuration on an installation whose platform has already been initialized, use the <a href="?page=BonitaBPM_platform_setup" ng-click="contentCtrl.goTo($event, 'BonitaBPM_platform_setup')">platform setup tool</a> to retrieve the current configuration and update the file in <code>setup/platform_conf/current/platform_portal</code>. Then use the tool again to save your changes into to the database.</p>
<p>When the secure flag is not active, this file contains this line:
<code>security.csrf.cookie.secure false</code></p>
<p>To activate the addition of the secure flag, edit the configuration file and change the <code>security.csrf.cookie.secure</code> value to <strong>true</strong>.</p>
<p><a href="?page=user-authentication-overview" ng-click="contentCtrl.goTo($event, 'user-authentication-overview')">User authentication overview</a>
<a href="http://www.acunetix.com/websitesecurity/csrf-attacks">Read more about CSRF attacks</a></p>
<h2>How to Migrate your pages to 7.4.0 or greater when CSRF security is enabled</h2>
<p>To use a UI page or form that was created in lower version than 7.4, you need to re-import this old page in actual UI designer. If you don't update your page, any API call in your outdated version will be failed because <code>X-Bonita-API-Token</code> will be absent in the response header.
Follow this few steps to update your page or form:</p>
<p>In UI designer:</p>
<ol>
<li><a href="?hash=import&amp;page=create-or-modify-a-page" ng-click="contentCtrl.goTo($event, 'create-or-modify-a-page', 'import')"><strong>Import</strong></a> the page from 7.3.X or lower version.</li>
<li><a href="?hash=export&amp;page=create-or-modify-a-page" ng-click="contentCtrl.goTo($event, 'create-or-modify-a-page', 'export')"><strong>Export</strong></a> the page you previously imported.</li>
</ol>
<p>In the portal as Administrator:</p>
<ol>
<li>Go on Resources entry.</li>
<li><a href="?hash=modify&amp;page=resource-management" ng-click="contentCtrl.goTo($event, 'resource-management', 'modify')">Edit the existing page</a> by uploading the new one.</li>
</ol>
<!-- Generated on Wed Dec 04 2019 17:46:51 GMT+0100 (Paris, Madrid) -->