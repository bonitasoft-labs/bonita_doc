<div style="position: relative;"><a href="https://github.com/bonitasoft/bonita-doc/edit/7.9/md/manage-users.md"><img style="position: absolute; top: -1px; right: -40px; border: 0; z-index=-100;" src="https://camo.githubusercontent.com/365986a132ccd6a44c23a9169022c0b5c890c387/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"></a></div>
<h1>Manage users</h1>
<p>Examples on how to create and edit users, to search for users data, through Bonita java API's.</p>
<h2>Create a new user</h2>
<p>This example shows you how to create a new user and assign the user to a profile.</p>
<p><strong>Create a new user</strong> by calling the createUser method:</p>
<pre><code class="language-groovy">// First of all, let's log in on the engine:
org.bonitasoft.engine.api.APIClient apiClient = new APIClient()
apiClient.login(&quot;install&quot;, &quot;install&quot;)
// create new user, with username john and password bpm
IdentityAPI identityAPI = apiClient.getIdentityAPI()
final User user = identityAPI.createUser(&quot;john&quot;, &quot;bpm&quot;)
System.out.println(&quot;New user created: &quot; + user)
</code></pre>
<p>Alternatively, you can create a more complex user object as follows:</p>
<pre><code class="language-groovy">// create complex user 
UserCreator creator = new UserCreator(&quot;john&quot;, &quot;bpm&quot;)
creator.setFirstName(&quot;Johnny&quot;).setLastName(&quot;B. Good&quot;)
ContactDataCreator proContactDataCreator = new ContactDataCreator().setAddress(&quot;32 rue 
        Gustave Eiffel&quot;).setCity(&quot;Grenoble&quot;).setPhoneNumber(&quot;555 14 12 541&quot;)
creator.setProfessionalContactData(proContactDataCreator)
final User user2 = identityAPI.createUser(creator)
</code></pre>
<p>Now add the user to a Bonita Portal profile. A user who does not have a profile cannot log in to Bonita Portal.</p>
<pre><code class="language-groovy">// The user must now be registered in a profile. Let's choose the existing &quot;User&quot; profile:
org.bonitasoft.engine.api.ProfileAPI orgProfileAPI = apiClient.getProfileAPI()
SearchOptionsBuilder searchOptionsBuilder = new SearchOptionsBuilder(0,10)
searchOptionsBuilder.filter(ProfileSearchDescriptor.NAME, &quot;User&quot;)
SearchResult&lt;Profile&gt; searchResultProfile = orgProfileAPI.searchProfiles(searchOptionsBuilder.done())
    
// we should find one result now
if (searchResultProfile.getResult().size() != 1) {
    return
}

// now register the user in the profile
Profile profile = searchResultProfile.getResult().get(0)
ProfileMemberCreator profileMemberCreator = new ProfileMemberCreator( profile.getId() )
profileMemberCreator.setUserId( user.getId() )
orgProfileAPI.createProfileMember(profileMemberCreator)
</code></pre>
<p>To create a user with more complete information, use the UserBuilder to create
an instance of User and then use the createUser method with the User as parameter.</p>
<h2>Add a user to a group</h2>
<p>This example shows how to add a user to a group.</p>
<p>The user, group, and role are already defined, and each one is specified by ID.
Note that it is not possible to add a user without a role.</p>
<pre><code class="language-groovy">final IdentityAPI identityAPI = apiClient.getIdentityAPI()
UserMembership membership = identityAPI.addUserMembership(userId, groupId, roleId)
</code></pre>
<h2>List the users in a group</h2>
<p>This example shows how to get a list of users in a specified group in the organization.</p>
<p>The group is specified by groupID. The search options specify that a maximum of 100 items are listed, starting with the first one.</p>
<pre><code class="language-groovy">final IdentityAPI identityAPI = apiClient.getIdentityAPI()
final SearchOptionsBuilder builder = new SearchOptionsBuilder(0, 100)
builder.filter(UserSearchDescriptor.GROUP_ID, groupID)
final SearchResult&lt;User&gt; userResults = identityAPI.searchUsers(builder.done())
</code></pre>
<h2>List the users with a specified role in a group</h2>
<p>This example shows how to get a list of the users who have the specified role in the specified group in the organization.</p>
<p>The group is specified by groupID. The role is specified by roleID. The search options specify that a maximum of 100 items are listed, starting with the first one.</p>
<pre><code class="language-groovy">final IdentityAPI identityAPI = apiClient.getIdentityAPI()
final SearchOptionsBuilder builder = new SearchOptionsBuilder(0, 100)
builder.filter(UserSearchDescriptor.GROUP_ID, groupID)
builder.filter(UserSearchDescriptor.ROLE_ID, roleID)
final SearchResult&lt;User&gt; userResults = identityAPI.searchUsers(builder.done())
</code></pre>
<h2>Get user contact data</h2>
<p>You can use the <code>getUserWithProfessionalDetails</code> method to retrieve a user and their professional contact data for a user.</p>
<p>This example shows how to get a user and the email address.</p>
<pre><code class="language-groovy">// Get the professional email address of a user
UserWithContactData proUser = apiClient.getIdentityAPI().getUserWithProfessionalDetails(user.getId())
proUser.getContactData().getEmail()
</code></pre>
<h2>Search for users</h2>
<p>The following example is a client application that accesses the Engine in HTTP mode to search for 20 users and display their names and identifiers.</p>
<pre><code class="language-groovy">package org.bonitasoft.example

import org.bonitasoft.engine.api.IdentityAPI
import org.bonitasoft.engine.api.LoginAPI
import org.bonitasoft.engine.api.APIClient
import org.bonitasoft.engine.identity.User
import org.bonitasoft.engine.search.SearchOptionsBuilder
import org.bonitasoft.engine.search.SearchResult
import org.bonitasoft.engine.session.APISession

public class BonitaClientApplicationExample {

    public static void main(final String[] args) throws Exception {

        // example code:
        APIClient apiClient = new APIClient()
        System.out.println(&quot;login with install//install&quot;)
        apiClient.login(&quot;install&quot;, &quot;install&quot;)
        final IdentityAPI identityAPI = apiClient.getIdentityAPI()
        final SearchResult&lt;User&gt; searchUsers = identityAPI.searchUsers(new SearchOptionsBuilder(0, 20).done())
        System.out.println(&quot;20 first users:&quot;)
        for (final User user : searchUsers.getResult()) {
            System.out.println(&quot; * &quot; + user.getUserName() + &quot; -- &quot; + user.getId())
        }
        apiClient.logout()
        System.out.println(&quot;logged out&quot;)
    }
}
</code></pre>
<h2>Get the pending tasks for a user</h2>
<p>This example shows you how use the Bonita Engine API to get the pending tasks for a user.</p>
<p>It shows how to get the list of pending tasks, and then for each task, how to assign it to the user and execute it.</p>
<p>To <strong>get the pending tasks</strong> for a given user, call the getPendingHumanTaskInstances method.
In this example, the first page of the current logged user's tasks are retrieved ordered by priority.
Each page contains up to 20 tasks.</p>
<pre><code class="language-groovy">// get the pending tasks for the current logged in user
final List&lt;HumanTaskInstance&gt; pendingTasks = 
       apiClient.getProcessAPI().getPendingHumanTaskInstances(session.getUserId(), 
           0, 20, ActivityInstanceCriterion.PRIORITY_ASC)
System.out.println(&quot;Pending tasks for user &quot; + session.getUserName() + &quot;: &quot; + pendingTasks)
</code></pre>
<p>Note that this does not return tasks that are already assigned to the user.</p>
<p>Then loop through the list of tasks. For each task, <strong>assign the task</strong> to the user and <strong>execute the task</strong>:</p>
<pre><code class="language-groovy">// assign and execute pending tasks
for (final HumanTaskInstance pendingTask : pendingTasks) {
    // assign the task to the user
    apiClient.getProcessAPI().assignUserTask(pendingTask.getId(), session.getUserId())
    // execute the task
    apiClient.getProcessAPI().executeFlowNode(pendingTask.getId())
}
</code></pre>
<h2>Get possible users of a task and execute task for a user</h2>
<p>This example shows how to get the list of users who are eligible to perform a task.</p>
<p>First, it creates a simple process containing one human task, called &quot;step1&quot;.
This task will be performed by a user who is mapped to the &quot;expert&quot; actor. An actor filter is applied to &quot;step1&quot;, assigning the task specifically to the superExpert user.</p>
<p>Next, it calls <code>getPossibleUsersOfHumanTask</code> to get the list of all users who are eligible to perform the step1 according to the process definition.
This will be a list of all the users who are mapped to the expert actor.</p>
<p>Next, it calls <code>getPossibleUsersOfPendingHumanTask</code> to get the list of users who will perform a specific instance of step1, in the process instance.
The actor filter is applied when the task instance is created. This is known as <strong>dynamic task assignment</strong>.
The actor filter is applied and a shorter list of users is returned (in this case, just superExpert).</p>
<p>Dynamic task assignment using <code>getPossibleUsersOfPendingHumanTask</code> re-evaluates the actor mapping.
It is useful if your organization changes after a process instance is started and you need to modify the list of users who can perform a task</p>
<p>If there is any Actor Filter specified for the given task, dynamic task assignment does not have any effect.<br>
In such case, there is another <a href="http://documentation.bonitasoft.com/javadoc/api/7.9/org/bonitasoft/engine/api/ProcessRuntimeAPI.html#updateActorsOfUserTask(long)" target="_self">method</a> that can be used as a separate call to force the re-execution of the actor filter and thus update the list of possible users.</p>
<p>Finally, it executes the task for the fist user on the list. This &quot;execute for&quot; feature is not available in the Community and Teamwork editions.</p>
<pre><code class="language-groovy">// Create a process definition containing a human task, step1
// Step1 is performed by actor expert adjusted by an actor filter


final ProcessDefinitionBuilder designProcessDefinition = new ProcessDefinitionBuilder().createNewInstance(&quot;assign&quot;, &quot;5.0&quot;)
designProcessDefinition.addActor(&quot;expert&quot;)
final UserTaskDefinitionBuilder taskDefinitionBuilder = designProcessDefinition.addUserTask(&quot;step1&quot;, &quot;expert&quot;)

        taskDefinitionBuilder.addUserFilter(&quot;test&quot;, &quot;org.bonitasoft.engine.filter.user.testFilter&quot;, &quot;1.0&quot;).addInput(&quot;userId&quot;,
                new ExpressionBuilder().createConstantLongExpression(superExpert.getId()))

final ProcessDefinition processDefinition = deployAndEnableWithActor(designProcessDefinition.done(), &quot;expert&quot;, role)

final ProcessInstance processInstance = apiClient.getProcessAPI().startProcess(processDefinition.getId())
Thread.sleep(3000)
final SearchOptionsBuilder searchOptionsBuilder = new SearchOptionsBuilder(0, 1)
searchOptionsBuilder.filter(HumanTaskInstanceSearchDescriptor.NAME, &quot;step1&quot;)
final HumanTaskInstance userTask = apiClient.getProcessAPI().searchHumanTaskInstances(searchOptionsBuilder.done()).getResult().get(0)

// Get all users of the actor of the userTask called 'step1'
List&lt;User&gt; possibleUsers = apiClient.getProcessAPI().getPossibleUsersOfHumanTask(processDefinition.getId(), &quot;step1&quot;, 0, 10)


// Get the filtered list of users for the task instance

possibleUsers = apiClient.getProcessAPI().getPossibleUsersOfPendingHumanTask(userTask.getId(), 0, 10)

// Execute task for first user in list
processAPI.assignUserTask(activityId, possibleUsers.get(0).getId())
processAPI.executeFlowNode(possibleUsers.get(0).getId(), activityId)

// Log out:
apiClient.logout()
</code></pre>
<!-- Generated on Wed Dec 04 2019 17:46:51 GMT+0100 (Paris, Madrid) -->