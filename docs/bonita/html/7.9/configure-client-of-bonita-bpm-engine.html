<div style="position: relative;"><a href="https://github.com/bonitasoft/bonita-doc/edit/7.9/md/configure-client-of-bonita-bpm-engine.md"><img style="position: absolute; top: -1px; right: -40px; border: 0; z-index=-100;" src="https://camo.githubusercontent.com/365986a132ccd6a44c23a9169022c0b5c890c387/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"></a></div>
<h1>Configure connection to Bonita Engine</h1>
<p>Learn how to configure your application to connect to a remote Bonita Engine, in order to access Engine APIs</p>
<p>If you want your application to use Bonita Engine APIs of a remote engine, your application (the <em>client</em>)
must configure the connection to the remote engine (the <em>server</em>)</p>
<p>The engine (the <em>server</em>) must also be configured to accept the connection.</p>
<p><strong>Note</strong>: the Bonita Portal can be configured to be used as a Client of the Bonita Engine. See the <a href="?page=two-main-types-of-deployment" ng-click="contentCtrl.goTo($event, 'two-main-types-of-deployment')">Alternate Bonita Deployment</a>
documentation for more information</p>
<a id="client_config" />
<h2>Client configuration</h2>
<p>There is three ways to configure the client to connect to the Bonita Engine.</p>
<p>First the engine client verify if the configuration is set programmatically,
then it tries to get the configuration set in system properties, finally it falls back to the legacy way of configuration that is the bonita home client.</p>
<h3>Configure Client using programmatic configuration</h3>
<p>You can configure the connection to the engine directly using <code>org.bonitasoft.engine.util.APITypeManager</code>, please refer to the <a href="http://documentation.bonitasoft.com/javadoc/api/7.9/org/bonitasoft/engine/util/APITypeManager.html" target="_self">Javadoc</a>.</p>
<p>Here is an example of programmatic configuration to an engine</p>
<pre><code class="language-java">HashMap&lt;String,String&gt; parameters= new HashMap&lt;&gt;();
parameters.put(&quot;server.url&quot;, &quot;http://myserver.com:8080&quot;);
parameters.put(&quot;application.name&quot;, &quot;bonita-application&quot;);
APITypeManager.setAPITypeAndParams(ApiAccessType.HTTP, parameters)
</code></pre>
<h3>Configure Client using System properties</h3>
<p>You can set the system property <code>org.bonitasoft.engine.api-type</code> to <code>HTTP</code>, <code>EJB3</code> or <code>LOCAL</code>.</p>
<ul>
<li><code>HTTP</code>:
The <code>HTTP</code> connection mode will connect the client to the engine using the http protocol. This is the most common way to connect to engine remotly.<br>
When using <code>HTTP</code> mode, you must set the following system properties
<ul>
<li><code>org.bonitasoft.engine.api-type.server.url</code>: it is the url of the server, e.g. for a engine on the same host it can be <code>http://localhost:8080</code></li>
<li><code>org.bonitasoft.engine.api-type.application.name</code>: it is the name of the web aplication on wich the engine HTTP API is deployed, e.g. <code>bonita</code></li>
</ul>
</li>
</ul>
<p>In addition, starting from version 7.9.4, the number of connections used by the client can be configured with system property <code>org.bonitasoft.engine.api-type.connections.max</code>, the default is 20.</p>
<div class="alert alert-warning" role="alert">
<p>We do not guarantee to keep the http protocol stable, so we strongly recommend that you use the same version for both
the client and the server</p>
</div>
<div class="alert alert-danger" role="alert">
<p>EJB communication protocol is removed in 7.10.</p>
</div>
<ul>
<li><code>EJB3</code> (deprecated, removed in 7.10)
The <code>EJB3</code> connection mode will connect the client to the engine using EJBs.<br>
You will need to specify at least <code>org.bonitasoft.engine.ejb.naming.reference</code> that is the name use to lookup the ServerAPI</li>
<li><code>LOCAL</code>
This is the default connection mode, it connects to the server in the same JVM (not remote). If nothing is set this mode will be used.</li>
</ul>
<h3>Configure client using Bonita Home client</h3>
<div class="alert alert-danger" role="alert">
<p>Deprecated, use the programmatic way instead, see <a href="http://documentation.bonitasoft.com/javadoc/api/7.9/org/bonitasoft/engine/util/APITypeManager.html" target="_self" class="alert-link">APITypeManager</a>.</p>
</div>
<p>This is a legacy way to configure the connection to the remote engine.</p>
<p>In this case you have to create a folder containing a <code>engine-client</code> directory and a <code>conf</code> subdirectory.
This last subdirectory must contain a file named <code>bonita-client-custom.properties</code> having as content configuration of the engine client (see below).
Finally set the System property <code>bonita.home</code> to the root folder you created.</p>
<p>Here is the default content of this configuration file, uncomment the part of the file corresponding to the type of connection you want and customize it according to your application.</p>
<pre><code class="language-properties">###template file
# LOCAL
org.bonitasoft.engine.api-type = LOCAL

# HTTP
#org.bonitasoft.engine.api-type = HTTP
#server.url = http://localhost:8080
#application.name = bonita
#connections.max = 20

# Remote: EJB3
#org.bonitasoft.engine.api-type = EJB3
# WildFly 10
#java.naming.factory.url.pkgs = org.jboss.ejb.client.naming
#default EJB reference name
#org.bonitasoft.engine.ejb.naming.reference=ejb:bonita-ear/bonita-ejb/serverAPIBean!org.bonitasoft.engine.api.internal.ServerAPI
</code></pre>
<h2>Server configuration</h2>
<h3>Server configuration to accept HTTP Connection</h3>
<p>By default <a href="?page=tomcat-bundle" ng-click="contentCtrl.goTo($event, 'tomcat-bundle')">Tomcat</a> and <a href="?page=wildfly-bundle" ng-click="contentCtrl.goTo($event, 'wildfly-bundle')">WildFly</a> bundles are configured to accept connection for HTTP connections.</p>
<p>It is configured in the <code>web.xml</code> file of the web application like this:</p>
<pre><code class="language-xml">&lt;servlet&gt;
    &lt;servlet-name&gt;HttpAPIServlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.bonitasoft.engine.api.internal.servlet.HttpAPIServlet&lt;/servlet-class&gt;
&lt;/servlet&gt;
</code></pre>
<div class="alert alert-warning" role="alert">
<p>This HTTP access  is not secured, it should not be exposed outside a trusted area. We recommend you to deactivate it if you expose directly your deployment to the outside world.</p>
</div>
<h3>Server configuration to accept EJB3 connection</h3>
<div class="alert alert-danger" role="alert">
<p>EJB communication protocol is removed in 7.10.</p>
</div>
<p>By default the <a href="?page=wildfly-bundle" ng-click="contentCtrl.goTo($event, 'wildfly-bundle')">WildFly bundle</a> is configured to accept connection for EJB3.</p>
<p>For an EJB3 client connection to work with WildFly 10, there are some additional configuration steps.</p>
<p>If the client is not located on the same host than the WildFly server, you need to create a Application user in the WildFly administration console.<br>
So open the WildFly administration console and <a href="https://docs.jboss.org/author/display/WFLY10/add-user+utility">create a user account</a> to be used for remote connections (for example, username <em>bonita</em> and password <em>bpm</em>).</p>
<p>Your Java client needs to have the WildFly client classes in the classpath for it to communicate correctly with the server.<br>
If you use Maven to manage your dependencies, add the following dependency in your pom.xml :</p>
<pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.wildfly&lt;/groupId&gt;
    &lt;artifactId&gt;wildfly-ejb-client-bom&lt;/artifactId&gt;
    &lt;version&gt;10.1.0.Final&lt;/version&gt;
    &lt;type&gt;pom&lt;/type&gt;
&lt;/dependency&gt;
</code></pre>
<p>The same kind of configuration is possible if you use some other dependency management tool like gradle or ivy.<br>
If you do not use any management tool, you have to include the <em>jboss-client.jar</em> to your classpath. It is available in the WildFly bundle in the $WILDFLY_HOME/bin/client folder.</p>
<p><em>Create a property file</em> named <code>jboss-ejb-client.properties</code>, to the client classpath.<br>
It contains information needed to make the remote connection, including the username and password of the user you created in the WildFly console, as shown below:</p>
<pre><code>endpoint.name=client-endpoint
remote.connectionprovider.create.options.org.xnio.Options.SSL_ENABLED=false
remote.connections=default

remote.connection.default.host=myhostname
remote.connection.default.port = 8080
remote.connection.default.connect.options.org.xnio.Options.SASL_POLICY_NOANONYMOUS=false
remote.connection.default.username=bonita
remote.connection.default.password=bpm
</code></pre>
<p>Update the <code>bonita-client.properties</code> file configured in the <code>${bonita.home}/client/conf</code> folder for the bonita client to connect to the server with the appropriate API type.</p>
<pre><code># Remote: EJB3
org.bonitasoft.engine.api-type = EJB3
# WildFly 10
java.naming.factory.url.pkgs = org.jboss.ejb.client.naming
#default EJB reference name
org.bonitasoft.engine.ejb.naming.reference=ejb:bonita-ear/bonita-ejb/serverAPIBean!org.bonitasoft.engine.api.internal.ServerAPI
</code></pre>
<p>If it is not already done for the WildFly server to accept remote connections, update the WildFly configuration file, standalone.xml:</p>
<ul>
<li>In the interfaces section, modify the IP address so that the Bonita Engine is visible to the network.</li>
<li>Specify that port 4447 comes from the remoting socket-binding.</li>
</ul>
<h2>Troubleshooting</h2>
<p>If the following stacktrace appears in your client console :</p>
<pre><code>IllegalStateException
Sep 29, 2015 3:46:16 PM org.jboss.ejb.client.EJBClient &lt;clinit&gt;
INFO: JBoss EJB Client version 1.0.5.Final
Exception in thread &quot;main&quot; java.lang.IllegalStateException: No EJB receiver available for handling [appName:bonita-ear,modulename:bonita-ejb,distinctname:] combination for invocation context org.jboss.ejb.client.EJBClientInvocationContext@24e6d224
        at org.jboss.ejb.client.EJBClientContext.requireEJBReceiver(EJBClientContext.java:584)
        at org.jboss.ejb.client.ReceiverInterceptor.handleInvocation(ReceiverInterceptor.java:119)
        at org.jboss.ejb.client.EJBClientInvocationContext.sendRequest(EJBClientInvocationContext.java:181)
        at org.jboss.ejb.client.EJBInvocationHandler.doInvoke(EJBInvocationHandler.java:136)
        at org.jboss.ejb.client.EJBInvocationHandler.doInvoke(EJBInvocationHandler.java:121)
        at org.jboss.ejb.client.EJBInvocationHandler.invoke(EJBInvocationHandler.java:104)
        at com.sun.proxy.$Proxy0.invokeMethod(Unknown Source)
        at org.bonitasoft.engine.api.EJB3ServerAPI.invokeMethod(EJB3ServerAPI.java:68)
        at org.bonitasoft.engine.api.impl.ClientInterceptor.invoke(ClientInterceptor.java:86)
        at com.sun.proxy.$Proxy1.login(Unknown Source)
        at org.support.bonitasoft.example.CountInstances.login(CountInstances.java:127)
        at org.support.bonitasoft.example.CountInstances.main(CountInstances.java:90)
</code></pre>
<p>It means that the <code>jboss-ejb-client.properties</code> has not been found in the classpath or that it has not been configured correctly.</p>
<!-- Generated on Wed Dec 04 2019 17:46:51 GMT+0100 (Paris, Madrid) -->