<div style="position: relative;"><a href="https://github.com/bonitasoft/bonita-doc/edit/7.9/md/insert-data-in-a-docx-odt-template.md"><img style="position: absolute; top: -1px; right: -40px; border: 0; z-index=-100;" src="https://camo.githubusercontent.com/365986a132ccd6a44c23a9169022c0b5c890c387/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"></a></div>
<h1>Insert data in a .docx/.odt template connector</h1>
<p>The <strong>insert data in a .docx/.odt template</strong> fills a specified template file by inserting values coming from the current process instance.</p>
<h2>Usage</h2>
<div class="alert alert-info" role="alert">
<p><strong>Note:</strong> For Enterprise, Performance, Efficiency, and Teamwork editions only.</p>
</div>
<p>The template is a LibreOffice/OpenOffice <code>.odt</code> file or a Microsoft Word<code>.docx</code> file with special placeholders called <code>keys</code>.<br>
A key is a replaceable element in the template that is identified with a dollar sign and surrounded by braces, (eg. ${element}), following the <a href="https://velocity.apache.org/engine/releases/velocity-1.7/user-guide.html">Velocity Template Language</a>.</p>
<p>To configure the connector for a task, add a connector (in or out) to the task, choose the &quot;Office&quot; category, and select &quot;insert data in a .dox/odt template&quot;.</p>
<p>In the connector configuration, the keys are mapped to variables from the process or from any other data source.<br>
At some point in the process instance, the template file must be set as the content of a document created at pool level.<br>
When the connector runs, it creates a file based on the template and inserts the current values of the relevant variables into the appropriate placeholders (keys) in the file.<br>
The generated file can replace the template in the same document or be stored in another document of the process. A common usage is to send the document by email or store it in an external information system using another connector.</p>
<h2>How to insert <code>keys</code> in a template file</h2>
<h3>Using Word (docx)</h3>
<div class="alert alert-info" role="alert">
<p><strong>Note:</strong> Tested versions are <strong>Microsoft Word 2007/2010</strong>. This connector may work with later versions.</p>
</div>
<h4>Create a <code>field</code></h4>
<ul>
<li>Insertion &gt; QuickPart &gt; Field...</li>
<li>Select FusionField (or MergeField in some Word versions) and use a template (see Velocity templating language) as field name (eg: ${name}, ${user.Name}...etc)</li>
<li>Click OK</li>
</ul>
<h4>Updating an existing <code>key</code></h4>
<ul>
<li>Right click on the Fusionfield to edit</li>
<li>Click on Update field...</li>
</ul>
<h3>Using LibreOffice (odt)</h3>
<ul>
<li>Insert &gt; Fields &gt; More fields...</li>
<li>Go to Variables tab, select UserField and use a template (see Velocity templating language) as value (eg: ${name}, ${user.Name}...etc)</li>
<li>Choose Text format</li>
<li>Click Insert<br>
For further information about the template design, <a href="https://code.google.com/p/xdocreport/wiki/DesignReport">click here</a>
<strong>Warning:</strong> there is a known issue when adding an image in a .docx using drag'n'drop instead of a copy/paste. The image is not rendered properly if you convert the generated file into PDF.</li>
</ul>
<h2>Example</h2>
<p>This example uses key values taken from a business variable.</p>
<h3>Business Data Model</h3>
<p>Here is a <a href="bonita/images/7.9/special_code/study-leave-template.docx" target="_blank">template example</a> for Leave Request submission and approval.<br>
This .docx file uses keys, most of which will be replaced by values from business variables created from the following <strong>Business Data Model</strong>:</p>
<p><img src="bonita/images/7.9/images-6_0/MyUser_Model_lazy.png" alt="" title=""></p>
<p><img src="bonita/images/7.9/images-6_0/Address_Model.png" alt="" title=""></p>
<p><img src="bonita/images/7.9/images-6_0/StudyLeave_Model.png" alt="" title=""></p>
<h3>Connector configuration</h3>
<p>The configuration is as follows:</p>
<p><img src="bonita/images/7.9/images-6_0/document_templating_input_mappings.png" alt="" title=""></p>
<p>In this example, the key named <code>user</code> is mapped to the business variable <code>user</code>, the key named <code>leave</code> is mapped to the business variable <code>studyLeave</code>, and the key named <code>today</code> is mapped to a groovy script expression with the following content:</p>
<pre><code class="language-groovy">        import java.text.SimpleDateFormat;
        new SimpleDateFormat(&quot;yyyy/MM/dd&quot;).format(new Date())
</code></pre>
<ul>
<li>If the keys are mapped with complex objects, pass the high level object to the mapping (eg. <strong>'user'</strong>). The connector will handle the sub-structure of this complex object (eg. <strong>${user.firstName}</strong>)</li>
<li>When using business variables, relations &quot;loaded when needed&quot; (lazy mode) are not loaded in a connector execution context. To use such relations, create new keys, like &quot;userAddress&quot; in the above example.</li>
<li>If the replacement value is null, then the field key will be rendered (eg. <strong>${userAddress.line2}</strong>). Use a &quot;!&quot; mark to render blank value, like <strong>$!{userAddress.line2}</strong> if userAddress.line2 may be null.</li>
</ul>
<p>And the output file mapping:</p>
<p><img src="bonita/images/7.9/images-6_0/document_templating_outputs.png" alt="" title=""></p>
<p>In this business example, the requesting user enters personal information in a process form. In a subsequent step, the reviewing user adds Approval information. The entered values are then provided as inputs to the <strong>insert data in a .docx/.odt template connector</strong> to replace the keys.<br>
The generated output file is then stored in a document of the process.<br>
This connector is built upon <strong>XdocReport</strong> third party library, for more information check their Wiki at <a href="https://github.com/opensagres/xdocreport/wiki">https://github.com/opensagres/xdocreport/wiki</a><br>
You will find out advanced report design documentation:</p>
<ul>
<li><a href="https://github.com/opensagres/xdocreport/wiki/DocxReportingJavaMainListFieldAdvancedTable">Loop for keys in table rows</a></li>
<li><a href="https://github.com/opensagres/xdocreport/wiki/DocxDesignReportMacro">Use a MS Word macro to design the report</a></li>
<li><a href="https://github.com/opensagres/xdocreport.samples">Report samples</a></li>
<li>...</li>
</ul>
<h2>Troubleshooting</h2>
<p>You may encounter memory issues using this connector as it has substantial size of dependencies. To workaround those issues you may increase the maximum memory allocation value of the Tomcat server JVM. Go to Preferences -&gt; Server settings -&gt; Increase the Tomcat Maximum memory allocation (<code>-Xmx</code> JVM argument) value to <strong>1024</strong> (512 by default). Do not forget to use the same value when configuring your production Bundle.</p>
<!-- Generated on Wed Dec 04 2019 17:46:51 GMT+0100 (Paris, Madrid) -->