<div style="position: relative;"><a href="https://github.com/bonitasoft/bonita-doc/edit/7.9/md/web-service-tutorial.md"><img style="position: absolute; top: -1px; right: -40px; border: 0; z-index=-100;" src="https://camo.githubusercontent.com/365986a132ccd6a44c23a9169022c0b5c890c387/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"></a></div>
<h1>Web service connector tutorial</h1>
<p>Learn how to use a Web Service connector to call a publicly available Web Service, store the answer and display the information.</p>
<p>The web service used in this example provides the capital of a given country.</p>
<ol>
<li>In the BDM, create a business object <em><strong>Country</strong></em> with the following attributes:</li>
</ol>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>STRING</td>
</tr>
<tr>
<td>capital</td>
<td>STRING</td>
</tr>
</tbody>
</table>
<ol start="2">
<li>Create the diagram (as shown in the example bellow)</li>
</ol>
<p><img src="bonita/images/7.9/connector_webservice_tuto/webservice_diagram.png" alt="web service process diagram" title="web service process diagram"></p>
<ol start="3">
<li>
<p>Select the Pool &gt; Data, click on the <em><strong>Pool Variables tab</strong></em>, add a process variable <em>country</em> (Text) and a Business variable <em>countryBo</em> (Country)</p>
</li>
<li>
<p>Select the Pool &gt; Execution, click on the <em><strong>Contract tab</strong></em>, and add a variable <em>countryInput</em> (Text) on the contract.</p>
</li>
<li>
<p>Add an instantiation form: select the Pool &gt; Execution, click on the <em><strong>Instantiation form tab</strong></em>, and click on the pencil on the right of the field <em>Target form</em>, it should open the UI designer. The idea here is to create a combo box which will propose some countries. The selected country will be passed to the contract.</p>
</li>
</ol>
<ul>
<li>Rename  the form into <em>countrySelection</em></li>
<li>Add a JSON data <em>countries</em>, with the following content:</li>
</ul>
<pre><code class="language-json">[{ &quot;name&quot;: &quot;France&quot;,&quot;code&quot;: &quot;FRA&quot;},{&quot;name&quot;: &quot;Switzerland&quot;,&quot;code&quot;: &quot;CH&quot;},{&quot;name&quot;: &quot;Finland&quot;,&quot;code&quot;: &quot;FI&quot;}]
</code></pre>
<ul>
<li>Add a select widget, with the following parameters:
<ul>
<li><strong>Availables values:</strong> countries</li>
<li><strong>Displayed key:</strong> name</li>
<li><strong>Returned key:</strong> code</li>
<li><strong>Value:</strong> formInput.countryInput</li>
</ul>
</li>
<li>Ensure in the preview that the combo box gives the possibility to select one of the countries, and we are done for the instantiation form.</li>
</ul>
<ol start="6">
<li>
<p>Go back on the <em>country</em> process variable, and set the <em>countryInput</em> as default value.</p>
</li>
<li>
<p>Select the  <em><strong>No</strong></em> flow,  go on the <em><strong>General tab</strong></em> and set this flow as the Default flow.</p>
</li>
<li>
<p>Select the  <em><strong>Yes</strong></em> flow, go on the <em><strong>General tab</strong></em>. Check <em>Use expression</em>, and add the following script as the expression to use:</p>
</li>
</ol>
<pre><code class="language-groovy">!countryDAO.findById(country, 0, 100).isEmpty()
</code></pre>
<ol start="9">
<li>Select the <em><strong>Retrieve already known capital task</strong></em>, go on the <em><strong>Execution tab</strong></em> and click on <em><strong>Operations</strong></em>. Add the following operation:</li>
</ol>
<ul>
<li><strong>Left operand</strong>: countryBo</li>
<li><strong>Operation</strong>: takeValueOf</li>
<li><strong>Right operand</strong>: A script <em>retrieveCountry</em>, with the following content:</li>
</ul>
<pre><code class="language-groovy">countryDAO.findById(country, 0, 100).get(0)
</code></pre>
<ol start="10">
<li>
<p>Select the <em><strong>retrieveUnknownCapital</strong></em> task, go on the <em><strong>Execution tab</strong></em> and click on <em><strong>Connectors in</strong></em>.</p>
</li>
<li>
<p>Add a <em><strong>WebService SOAP 1.2</strong></em> connector to this task and configure it using the wizard.</p>
</li>
<li>
<p>In the <strong>Connection parameters</strong> window:</p>
</li>
</ol>
<ul>
<li>For the Community edition, provide these settings:
<ul>
<li>Service NS: CountryInfoService</li>
<li>Service name: http://www.oorsprong.org/websamples.countryinfo</li>
</ul>
</li>
<li>For the Teamwork, Efficiency, Performance, or Enterprise edition. provide these settings:
<ul>
<li>Enter the WDSL URL http://webservices.oorsprong.org/websamples.countryinfo/CountryInfoService.wso?WSDL, and click on the Introspect button, then leave the login info fields empty</li>
</ul>
</li>
</ul>
<ol start="13">
<li>In the <strong>Request parameters</strong> window (for all editions), provide these settings:</li>
</ol>
<ul>
<li>Port name: CountryInfoServiceSoap12</li>
<li>End point address: http://webservices.oorsprong.org/websamples.countryinfo/CountryInfoService.wso</li>
<li>Binding: http://www.w3.org/2003/05/soap/bindings/HTTP/</li>
<li>Envelope</li>
</ul>
<pre><code class="language-xml">       &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
    &lt;soap12:Envelope xmlns:soap12=&quot;http://www.w3.org/2003/05/soap-envelope&quot;&gt;
      &lt;soap12:Body&gt;
        &lt;CapitalCity xmlns=&quot;http://www.oorsprong.org/websamples.countryinfo&quot;&gt;
          &lt;sCountryISOCode&gt;${country}&lt;/sCountryISOCode&gt;
        &lt;/CapitalCity&gt;
      &lt;/soap12:Body&gt;
    &lt;/soap12:Envelope&gt;
</code></pre>
<ol start="14">
<li>In the <strong>Response configuration</strong> window, check the <strong>Returns body</strong> checkbox to use the response body in the output operations.</li>
<li>In the <strong>Output operations</strong> window, keep only one output operation:</li>
</ol>
<ul>
<li><strong>Left operand</strong>: countryBo</li>
<li><strong>Operation</strong>: Java method -&gt; setCapital</li>
<li><strong>Right operand</strong>: A script <em>parseCapital</em>  returning a String, with the following content</li>
</ul>
<pre><code class="language-groovy">import org.codehaus.groovy.ast.stmt.ContinueStatement
import org.w3c.dom.NodeList

responseDocumentBody.childNodes.item(0).textContent
</code></pre>
<p>And we are done for the connector configuration. If you want to test it from the wizard, replace <em>${country}</em> by <em>FRA</em> in the envelope, and ensure that <em>Paris</em> is returned.</p>
<ol start="16">
<li>Select the <em><strong>Retrieve unknown capital</strong></em> task, go on the <em><strong>Execution tab</strong></em>, click on <em><strong>Operations</strong></em> and add the following operation:</li>
</ol>
<ul>
<li><strong>Left operand</strong>: countryBo</li>
<li><strong>Operation</strong>: Use a java method -&gt; setId</li>
<li><strong>Right operand</strong>: country</li>
</ul>
<ol start="17">
<li>Select the <em><strong>Display capital</strong></em> task, go on the <em><strong>Execution tab</strong></em>, click on <em><strong>Form</strong></em> and click on the pencil to create the form of this task. The UI Designer should open. The idea here is to simply display the field <em>capital</em> of the business object used in the case (which has been created during the case or retrieved from the database). This business object is accessible in the context.</li>
</ol>
<ul>
<li>Create a <em><strong>Javascript expression</strong></em> variable named <em><strong>api</strong></em>, with the following content:</li>
</ul>
<pre><code class="language-Javascript">return &quot;../&quot; + $data.context.countryBo_ref.link;
</code></pre>
<ul>
<li>Create an <em><strong>External API</strong></em> variable named <em><strong>country</strong></em>, with the following api url:</li>
</ul>
<pre><code>{{api}}
</code></pre>
<ul>
<li>Insert a text widget in the form, with the following text property:</li>
</ul>
<pre><code>Capital: {{country.capital}}
</code></pre>
<p>Rename the form into <em><strong>Display capital</strong></em>, save it, and we are done.</p>
<ol start="18">
<li>We do not want to implement a case overview for this simple use case. Select the pool, go on the <em><strong>Execution tab</strong></em>, click on <em><strong>Overview page</strong></em> and select <em><strong>No form</strong></em>.</li>
</ol>
<ol start="19">
<li>Test the process, by following those steps:</li>
</ol>
<ul>
<li>Select the pool</li>
<li>Configure the actor mapping to the group &quot;/acme&quot;</li>
<li>Click on the &quot;Run&quot; button to install and enable the process and be redirected to the instantiation form</li>
<li>From the instantiation form in your browser, select a country and submit</li>
<li>The browser will be redirected to the user perspective in the Portal</li>
<li>A new task &quot;Display Capital&quot; should be available (refresh if not), click on it</li>
<li>The capital should appear on its associated form</li>
</ul>
<!-- Generated on Wed Dec 04 2019 17:46:52 GMT+0100 (Paris, Madrid) -->