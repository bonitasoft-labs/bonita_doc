<div style="position: relative;"><a href="https://github.com/bonitasoft/bonita-doc/edit/7.7/md/rest-api-authentication.md"><img style="position: absolute; top: -1px; right: -40px; border: 0; z-index=-100;" src="https://camo.githubusercontent.com/365986a132ccd6a44c23a9169022c0b5c890c387/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"></a></div>
<h1>REST API authentication</h1>
<p>To call the REST API, you must first log on with a user registered in the Engine database.</p>
<h2>Login to Bonita</h2>
<p>To log in, use the following request:</p>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:left"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Request URL</td>
<td style="text-align:left"><code>http://host:port/bonita/loginservice</code></td>
</tr>
<tr>
<td style="text-align:left">Request Method</td>
<td style="text-align:left">POST</td>
</tr>
<tr>
<td style="text-align:left">Content-Type</td>
<td style="text-align:left">application/x-www-form-urlencoded</td>
</tr>
<tr>
<td style="text-align:left">Form Data</td>
<td style="text-align:left">username: a username<br/>password: a password <br/>redirect: true or false. false indicates that the service should not redirect to Bonita Portal (after a successful login) or to the login page (after a login failure).<br/>redirectURL: the URL of the page to be displayed after login <br/>tenant: the tenant to log in to (optional for Performance edition, not supported for Community, Teamwork and Efficiency editions)</td>
</tr>
</tbody>
</table>
<p>The response to this call generates cookies.
The <code>JSESSIONID</code> must be transfered with each subsequent calls. If the REST API is used in an application running in a web browser, this is handled automatically by the web browser.
For usage of the <code>X-Bonita-API-Token</code> see below.</p>
<h3>X-Bonita-API-Token cookie and HTTP header</h3>
<p>The security against CSRF attacks is enabled by default for all fresh installations.</p>
<p>This security relies on <code>X-Bonita-API-Token</code> information. The <code>X-Bonita-API-Token</code> value can be found in the cookie named: <code>X-Bonita-API-Token</code>. All the subsequence REST API calls using DELETE, POST, or PUT HTTP methods must contain the <strong>HTTP header</strong> below:</p>
<pre><code>X-Bonita-API-Token: example-dummy-not-be-used-value
</code></pre>
<h3>Example using Curl</h3>
<h4>Login</h4>
<pre><code>$ curl -v -c saved_cookies.txt -X POST --url 'http://localhost:8080/bonita/loginservice' \
--header 'Content-Type: application/x-www-form-urlencoded; charset=utf-8' -O /dev/null \
-d 'username=walter.bates&amp;password=bpm&amp;redirect=false&amp;redirectURL='
</code></pre>
<p>The above <code>curl</code> command saved the cookies on the disk, in the <code>saved_cookies.txt</code> file.
The cookies file must be reused with the REST API calls (HTTP requests) in order to provide session information.
The value of X-Bonita-API-Token cookie must be passed also in the header of the subsequent REST API calls, when any of the POST, PUT or DELETE HTTP method is used.</p>
<p>The content of the cookies file is below:</p>
<pre><code>$ cat saved_cookies.txt

localhost	FALSE	/bonita/	FALSE	0	bonita.tenant	1
#HttpOnly_localhost	FALSE	/bonita/	FALSE	0	JSESSIONID	9F9665280B367259AC421378B69C3244
localhost	FALSE	/	FALSE	0	X-Bonita-API-Token	2f86dcab-9b54-45e6-8eb1-f82c2a2f8e25
</code></pre>
<h4>Call an API when authenticated</h4>
<p>Let's list processes from the API by providing authentication information.</p>
<pre><code>$ curl -b saved_cookies.txt -X GET --url 'http://localhost:8080/bonita/API/bpm/process?c=100&amp;p=0'
</code></pre>
<h2>Logout from Bonita</h2>
<p>When processing is complete, you must log out.</p>
<p>To log out, use the following request:</p>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:left"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Request URL</td>
<td style="text-align:left"><code>http://host:port/bonita/logoutservice</code></td>
</tr>
<tr>
<td style="text-align:left">Request Method</td>
<td style="text-align:left">GET</td>
</tr>
<tr>
<td style="text-align:left">Query parameter</td>
<td style="text-align:left">redirect: true or false (default set to true)</td>
</tr>
</tbody>
</table>
<p>Setting the redirect parameter to false indicates that the service should not redirect to the login page after logging out.</p>
<h4>Troubleshooting</h4>
<h5>HTTP/1.1 401 Unauthorized</h5>
<p>If the HTTP response's status is <code>401 Unauthorized</code>:</p>
<ul>
<li>make sure that the cookies have been transfered with the call</li>
<li>make sure that the cookies transfered are the ones generated during the last sucessfull login call</li>
<li>if one of the PUT, DELETE or POST method is used, make sure that the <code>X-Bonita-API-Token</code> header is included</li>
<li>if the X-Bonita-API-Token header is included, make sure that the value is the same as the one of the cookie generated during the last login</li>
<li>Maybe a logout was issued or the session has expired; try to log in again, and re run the request with the new cookies and the new value for the <code>X-Bonita-API-Token</code> header.</li>
</ul>
<!-- Generated on Wed Dec 04 2019 13:25:31 GMT+0100 (Paris, Madrid) -->