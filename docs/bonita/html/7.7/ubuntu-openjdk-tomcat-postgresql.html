<div style="position: relative;"><a href="https://github.com/bonitasoft/bonita-doc/edit/7.7/md/ubuntu-openjdk-tomcat-postgresql.md"><img style="position: absolute; top: -1px; right: -40px; border: 0; z-index=-100;" src="https://camo.githubusercontent.com/365986a132ccd6a44c23a9169022c0b5c890c387/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"></a></div>
<h1>Custom Bonita Platform Setup</h1>
<p>How to set up a Bonita Platform from scratch in a specific environment (Ubuntu, Openjdk, Tomcat, PostgreSQL).</p>
<h2>Operating System</h2>
<p>Install a Ubuntu Linux distribution.
Simply follow a standard Ubuntu installation procedure. You won't need any specific settings here.</p>
<p>Note: make sure you got a text editor installed such as <code>nano</code>. In order to install it: <code>sudo apt-get install nano</code></p>
<p>Note: we use <code>aptitude</code> command line tool to install packages such as OpenJDK or PostgreSQL. You can also use different tool such
as <code>apt-get</code> or a graphical package manager such as <code>synaptic</code>.</p>
<h2>Java Virtual Machine</h2>
<p>To install the OpenJDK JVM you need to install the <code>openjdk-8-jre-headless</code> package:</p>
<ul>
<li>Run the following command line: <code>sudo aptitude install openjdk-8-jre-headless</code></li>
<li>If needed, type your Ubuntu user password</li>
<li>Type <em><strong>Enter</strong></em> to confirm that you want to continue installation</li>
</ul>
<p>To check that Java is correctly setup in a console/terminal, type: <code>java -version</code>.
You should get a similar message to the one below:</p>
<pre><code>openjdk version &quot;1.8.0_111&quot;
OpenJDK Runtime Environment (build 1.8.0_111-8u111-b14-2ubuntu0.16.04.2-b14)
OpenJDK 64-Bit Server VM (build 25.111-b14, mixed mode)
</code></pre>
<h2>Database</h2>
<h3>Install</h3>
<p>To install the PostgreSQL 9.3 you need to install the <code>postgres-9.3</code> package:</p>
<ul>
<li>Run the following command line: <code>sudo aptitude install postgresql-9.3</code></li>
<li>If needed, type your Ubuntu user password</li>
<li>Type <em><strong>Enter</strong></em> to confirm that you want to continue installation</li>
</ul>
<h3>Create databases and user</h3>
<p>You now need to create: a new PostgreSQL user and two new databases for Bonita, and grant the user the appropriate privileges to access
the databases. In a terminal or console, type following commands:</p>
<ul>
<li>Switch to a shell for <code>postgres</code> user account: <code>sudo -u postgres -i</code></li>
<li>To create a new database user named <code>bonita_db_user</code> type: <code>createuser -P bonita_db_user</code></li>
<li>Enter (twice) the password for the newly created database user. E.g.: <code>bonita_db_password</code></li>
<li>Create a new database (for Bonita Engine) named <code>bonita_db</code> and give ownership to <code>bonita_db_user</code>: <code>createdb -O bonita_db_user bonita_db</code></li>
<li>Create another database (for BDM) named <code>bonita_bdm</code> and give ownership to <code>bonita_db_user</code>: <code>createdb -O bonita_db_user bonita_bdm</code></li>
<li>Exit <code>postgres</code> session, type command: <code>exit</code></li>
</ul>
<p>You can now verify that user and database are correctly created. In a terminal or console type following commands:</p>
<ul>
<li>Start PostgreSQL client program by typing: <code>psql -d bonita_db -h 127.0.0.1 -U bonita_db_user</code></li>
<li>Type the PostgreSQL user password. E.g.: bonita_db_password</li>
<li>You can run test query that should return <code>1</code>: <code>SELECT 1;</code></li>
<li>Now you can quit PostgreSQL client, type: <code>\q</code></li>
</ul>
<h3>Enable prepared transactions</h3>
<p>Prepared transactions is disabled by default in PostgreSQL. You need to enable it:</p>
<ul>
<li>Edit the <code>postgresql.conf</code> configuration file: <code>sudo nano /etc/postgresql/9.3/main/postgresql.conf</code></li>
<li>Look for the line with <code>max_prepared_transactions</code> (line 117)</li>
<li>Uncomment the line: remove <code>#</code> character</li>
<li>Change the value from <code>zero</code> to <code>100</code></li>
<li>Save modification and quit text editor</li>
<li>Restart PostgreSQL server: <code>sudo service postgresql restart</code></li>
</ul>
<h2>Application Server</h2>
<h3>Install Tomcat 8.5</h3>
<p>Run the following command lines:</p>
<ul>
<li><code>sudo aptitude install curl</code></li>
<li><code>cd /tmp/</code></li>
<li><code>wget http://apache.mirrors.ionfish.org/tomcat/tomcat-8/v8.5.31/bin/apache-tomcat-8.5.31.tar.gz</code></li>
<li><code>sudo tar xzvf apache-tomcat-8.5.31.tar.gz -C /usr/share/tomcat8 --strip-components=1</code></li>
</ul>
<p>Tomcat 8.5 should now be installed on your computer. Now you should enable tomcat to be run as a service</p>
<ul>
<li><code>sudo nano /etc/systemd/system/tomcat.service</code></li>
<li>Copy the following code into the file</li>
</ul>
<pre><code>[Unit]
Description=Apache Tomcat Web Application Container
After=network.target

[Service]
Type=forking

Environment=JAVA_HOME=Your Java Home
Environment=CATALINA_PID=/usr/share/tomcat/temp/tomcat.pid
Environment=CATALINA_HOME=/usr/share/tomcat
Environment=CATALINA_BASE=/usr/share/tomcat
Environment='CATALINA_OPTS=-Xms512M -Xmx1024M -server -XX:+UseParallelGC'
Environment='JAVA_OPTS=-Djava.awt.headless=true -Djava.security.egd=file:/dev/./urandom'

ExecStart=/usr/share/tomcat/bin/startup.sh
ExecStop=/usr/share/tomcat/bin/shutdown.sh

User=yourUser
Group=yourGroup
UMask=0007
RestartSec=10
Restart=always

[Install]
WantedBy=multi-user.target
</code></pre>
<ul>
<li>Save and close the file</li>
<li>Reload the systemd daemon: <code>sudo systemctl daemon-reload</code></li>
</ul>
<p>In case of problems with this part refer to the documentations pages <a href="https://www.howtoforge.com/tutorial/how-to-install-apache-tomcat-8-5-on-ubuntu-16-04/">How to Install and Configure Apache Tomcat 8.5 on Ubuntu 16.04</a></p>
<h3>Add JDBC driver</h3>
<p>You need to include JDBC driver in Tomcat classpath:</p>
<ul>
<li>Change to Tomcat libraries directory: <code>cd /usr/share/tomcat8/lib</code></li>
<li>Install <code>wget</code> tool in order to be able to download JDBC driver: <code>sudo aptitude install wget</code></li>
<li>Download the JDBC driver: <code>sudo wget http://jdbc.postgresql.org/download/postgresql-9.3-1102.jdbc4.jar</code></li>
</ul>
<h2>Bonita Platform</h2>
<h3>Download and unzip the Bonita deploy bundle</h3>
<p>Download the Bonita deploy bundle from the <a href="https://customer.bonitasoft.com/">Customer Portal</a>
(Subscription editions) or get the <a href="http://www.bonitasoft.com/downloads-v2">Community edtion</a>. Instructions
below will be given for Bonita Subscription Pack. You can easily adapt files and folder names to your edition.</p>
<ul>
<li>Go to Bonitasoft <a href="https://customer.bonitasoft.com/">Customer Portal</a></li>
<li>In <strong>Download</strong> menu, click on <em><strong>Request a download</strong></em></li>
<li>Select your version and click on <em><strong>Access download page</strong></em> button</li>
<li>On the download page, go to the <strong>Deploying Server Components</strong> section</li>
<li>Click on <em><strong>Download BonitaSubscription-x.y.z-deploy.zip</strong></em> link. If your server only has a terminal available
you can copy the link and use <code>wget</code> to download the file or use SSH with <code>scp</code> command to copy
the file from another computer.</li>
<li>Make sure that the <code>BonitaSubscription-x.y.z-deploy.zip</code> is located in your home folder (e.g. <code>/home/osuser</code>).
If you type <code>cd ~ &amp;&amp; ls</code> you should see the file listed.</li>
<li>Make sure the <code>unzip</code> command is installed: <code>sudo aptitude install unzip</code></li>
<li>Unzip the deploy bundle: <code>unzip -q BonitaSubscription-x.y.z-deploy.zip</code></li>
</ul>
<p>Finally, make sure that the user that runs the Tomcat server, is the owner of all Bonita &quot;home&quot; files:</p>
<ul>
<li>Change folders and files ownership: <code>sudo chown -R tomcat8:tomcat8 /opt/bonita</code></li>
</ul>
<h3>JVM system variables</h3>
<p>To define JVM system properties, you need to use a new file named <code>setenv.sh</code>:</p>
<ul>
<li>Copy the file from deploy bundle to Tomcat <code>bin</code> folder: <code>sudo cp ~/BonitaSubscription-x.y.z-deploy/Tomcat-8.5.z/bin/setenv.sh /usr/share/tomcat8/bin/</code>, where &quot;x.y.z&quot; stands for your current product version.</li>
<li>Make the file executable: <code>sudo chmod +x /usr/share/tomcat8/bin/setenv.sh</code></li>
<li>Edit <code>setenv.sh</code> file: <code>sudo nano /usr/share/tomcat8/bin/setenv.sh</code></li>
<li>Change <code>sysprop.bonita.db.vendor</code> from <code>h2</code> to <code>postgres</code></li>
<li>Change <code>btm.root</code> from <code>${CATALINA_HOME}</code> to <code>/opt/bonita/btm</code></li>
<li>Change <code>bitronix.tm.configuration</code> from <code>${CATALINA_HOME}/conf/bitronix-config.properties</code> to <code>/opt/bonita/btm/conf/bitronix-config.properties</code></li>
</ul>
<h3>Add extra libraries to Tomcat</h3>
<p>Bonita needs extra libraries such as Bitronix, in order to run on Tomcat:</p>
<ul>
<li>Change to the Deploy bundle Tomcat lib folder: <code>cd ~/BonitaSubscription-x.y.z-deploy/Tomcat-8.5.z/lib</code>, where &quot;y.z&quot; stands for the last digits of the product version</li>
<li>Copy the libraries (.jar files) from the Deploy bundle to your Tomcat folder: <code>sudo cp btm-2.1.3.jar btm-tomcat55-lifecycle-2.1.3.jar jta-1.1.jar slf4j-api-1.6.1.jar slf4j-jdk14-1.6.1.jar /usr/share/tomcat8/lib/</code> (carefully check and replace with the product versions you currently have)</li>
</ul>
<h3>Configure Bonita to use PostgreSQL</h3>
<p>You need to configure the data source for Bonita Engine.</p>
<p>Warning: make sure you stop Tomcat before performing following operations: <code>sudo service tomcat8 stop</code></p>
<ul>
<li>Create new folders in order to store Bitronix files: <code>sudo mkdir -p /opt/bonita/btm/conf &amp;&amp; sudo mkdir /opt/bonita/btm/work</code></li>
<li>Set the ownership of the Bitronix folder: <code>sudo chown -R tomcat8:tomcat8 /opt/bonita/btm</code></li>
<li>Copy the Bitronix configuration files to <code>/opt/bonita/btm/conf</code> folder: <code>sudo cp ~/BonitaSubscription-x.y.z-deploy/Tomcat-8.5.z/conf/bitronix-* /opt/bonita/btm/conf/</code></li>
<li>Edit <code>bitronix-resources.properties</code> file, comment (using <code>#</code>) h2 section, uncomment PostgreSQL example
and update the username, password and DB name (&quot;bonita&quot; in the URL property) to match your configuration (e.g.
<code>bonita_db_user</code>, <code>bonita_db_password</code> and <code>bonita_db</code>): <code>sudo nano /opt/bonita/btm/conf/bitronix-resources.properties</code></li>
<li>Also in <code>bitronix-resources.properties</code> update the section for <code>resource.ds2</code> (BDM data source) and set the value for the BDM data base (e.g. <code>bonita_db_user</code>, <code>bonita_db_password</code> and <code>bonita_bdm</code>)</li>
<li>Save and quit: <code>CTRL+X, Y, ENTER</code></li>
<li>Copy the <code>bonita.xml</code> file (Bonita web app context configuration): <code>sudo cp ~/BonitaSubscription-x.y.z-deploy/Tomcat-8.5.z/conf/Catalina/localhost/bonita.xml /etc/tomcat8/Catalina/localhost/</code></li>
<li>Edit the <code>bonita.xml</code> file by commenting the h2 datasource configuration (using ),
uncomment PostgreSQL example and update username, password and DB name (bonita in the URL property) to match your
configuration (e.g. <code>bonita_db_user</code>, <code>bonita_db_password</code> and <code>bonita_db</code>): <code>sudo nano /etc/tomcat8/Catalina/localhost/bonita.xml</code></li>
<li>Also in <code>bonita.xml</code> file update data base configuration for BDM to match your configuration (e.g. <code>bonita_db_user</code>, <code>bonita_db_password</code> and <code>bonita_bdm</code>)</li>
<li>Save and quit: <code>CTRL+X, Y, ENTER</code></li>
<li>Copy and overwrite <code>logging.properties</code> file: <code>sudo cp ~/BonitaSubscription-x.y.z-deploy/Tomcat-8.5.z/conf/logging.properties /etc/tomcat8/logging.properties</code></li>
<li>Copy and overwrite <code>context.xml</code> file: <code>sudo cp ~/BonitaSubscription-x.y.z-deploy/Tomcat-8.5.z/conf/context.xml /etc/tomcat8/context.xml</code></li>
<li>Copy and overwrite <code>server.xml</code> file: <code>sudo cp ~/BonitaSubscription-x.y.z-deploy/Tomcat-8.5.z/conf/server.xml /etc/tomcat8/server.xml</code></li>
<li>Edit <code>server.xml</code> (<code>sudo nano /etc/tomcat8/server.xml</code>) and comment out h2 listener line</li>
<li>Fix ownership on the copied files: <code>sudo chown -R root:tomcat8 /etc/tomcat8</code></li>
</ul>
<h3>License</h3>
<p>If you run the Subscription Pack version, you will need a license:</p>
<ul>
<li>Generate the key in order to get a license:
<ul>
<li>Change the current directory to license generation scripts folder: <code>cd ~/BonitaSubscription-x.y.z-deploy/request_key_utils-x.y-z</code></li>
<li>Make the license generation script executable: <code>chmod u+x generateRequestKey.sh</code></li>
<li>Run the script: <code>./generateRequestKey.sh</code></li>
<li>For <code>License type:</code> enter <code>1</code> to select <code>1 - Case counter license.</code> (<em>Note</em>: If your subscription type is cpu based, please refer to the <a href="https://customer.bonitasoft.com/knowledgebase">knowledge-base</a> in the customer portal)</li>
<li>You will get a license key number that you can copy. Make sure that you keep the brackets. If the key is separated by a linebreak, remove it and put the key on a single line.</li>
</ul>
</li>
<li>Connect to Bonitasoft <a href="https://customer.bonitasoft.com/">Customer Portal</a></li>
<li>Go to Licenses &gt; <strong>Request a license</strong></li>
<li>Fill in the license request forms</li>
<li>You should receive the license file by email</li>
<li>Copy the license file to the Bonita &quot;home&quot; folder: <code>sudo cp BonitaSubscription-x.y-Your_Name-ServerName-YYYYMMDD-YYYYMMDD.lic /opt/bonita/bonita_home-x.y.z/server/licenses/</code></li>
<li>Change folders and files ownership: <code>sudo chown -R tomcat8:tomcat8 /opt/bonita</code></li>
</ul>
<h3>Deployment</h3>
<p>Deploy the Bonita web application:</p>
<p>Copy <code>bonita.war</code> to Tomcat <code>webapps</code> folder: <code>sudo cp ~/BonitaSubscription-x.y.z-deploy/Tomcat-8.5.z/webapps/bonita.war /var/lib/tomcat8/webapps/</code></p>
<p>Take care to set the proper owner: <code>sudo chown tomcat8:tomcat8 /var/lib/tomcat8/webapps/bonita.war</code></p>
<p>Start Tomcat: <code>sudo service tomcat8 start</code></p>
<h3>First connection</h3>
<p>You can access the Bonita Portal using your web browser, just type the following URL <code>http://&lt;your_server_hostname&gt;:8080/bonita</code> (your_server_hostname can be either an IP address or a name).<br>
You can log in using the tenant administrator login: <code>install</code> and password: <code>install</code>.<br>
The first step is to create at least one user and add it to &quot;administrator&quot; and &quot;user&quot; profiles.</p>
<!-- Generated on Wed Dec 04 2019 13:25:31 GMT+0100 (Paris, Madrid) -->