<div style="position: relative;"><a href="https://github.com/bonitasoft/bonita-doc/edit/7.7/md/single-sign-on-with-cas.md"><img style="position: absolute; top: -1px; right: -40px; border: 0; z-index=-100;" src="https://camo.githubusercontent.com/365986a132ccd6a44c23a9169022c0b5c890c387/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"></a></div>
<h1>CAS SSO configuration</h1>
<p>Bonita can be configured to use CAS to provide single sign-on (SSO), as long as you already have a working CAS service and all Bonita users are registered in CAS.</p>
<div class="alert alert-info" role="alert">
<p><strong>Note:</strong> For Enterprise, Performance, Efficiency, and Teamwork editions only.</p>
</div>
<p>This information applies to a Bonita platform deployed from a bundle, not to the Engine launched from Bonita Studio.</p>
<p>CAS configuration is at tenant level. Each tenant can use a different CAS service.</p>
<p>Note: On a system using CAS to manage logins, if a user who is not already logged in tries to access a page in the Portal by clicking on a URL link, they are re-directed to the login page.
After logging in, the requested page is not displayed automatically. The user must click the link again.</p>
<h2>Return URL</h2>
<p>When the user visits the bonita web application using a web browser, the bonita portal redirects it to the CAS server.
The URL to the CAS server contains the <code>service</code> parameter: the value is an encoded return URL, that the CAS server should use to redirect back the user in case of successful authentication.</p>
<p>The return URL is not set by configuration; the <code>server</code> and <code>port</code> are taken out from the incoming HTTP request which reached the application server. By default, the web application server is configured to use the value of the <code>Host:</code> header (see the HTTP 1.1 standard) when present.</p>
<p>When a reverse proxy is used, the <code>server</code> and <code>port</code> of the HTTP request generated by the reverse proxy are not the same than the ones used in the original HTTP request in the user's web browser.</p>
<p>As a consequence, configure the reverse proxy to include the <code>Host:</code> header when forwarding the request to the web application server.</p>
<div class="alert alert-info" role="alert">
<p>The method <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServletRequest.html#getRequestURL--" class="alert-link"><code>getRequestURL ot HttpServletRequest</code></a> is used internaly to retrieve the <code>server</code> and <code>port</code> of the HTTP request.</p>
</div>
<p>::: example
<strong>Reverse proxy configuration:</strong>  use the <a href="http://httpd.apache.org/docs/2.2/mod/mod_proxy.html#proxypreservehost">ProxyPreserveHost</a> property (Apache 2.0.31 or greater).
:::</p>
<p>If you need more fine tuning or if you cannot update the reverse proxy configuration, you can consult the official documentation for <a href="https://tomcat.apache.org/connectors-doc/common_howto/proxy.html">Tomcat</a> or <a href="https://docs.jboss.org/author/display/WFLY10/Undertow+subsystem+configuration">WildFly</a>.</p>
<h2>Configure Bonita Engine and WildFly for CAS</h2>
<p>The deploy bundle contains the files needed to use CAS with Bonita platform and a WildFly 10 application server.<br>
They are contained in <code>cas-3.3.1-module</code>.</p>
<p>You can use this folder to configure CAS for a platform deployed from the WildFly bundle or from the deploy bundle.<br>
The <code>cas-3.3.1-module</code> folder contains some jar files that are required.</p>
<p>It also contains a configuration file for the module, <code>module.xml</code>, which defines the jar files to be loaded from the module itself and the dependencies of the module. For example:</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;module xmlns=&quot;urn:jboss:module:1.0&quot; name=&quot;org.jasig.cas&quot;&gt;
    &lt;resources&gt;
        &lt;resource-root path=&quot;cas-client-core-3.3.1.jar&quot; /&gt;
        &lt;resource-root path=&quot;slf4j-api-1.7.1.jar&quot; /&gt;
        &lt;resource-root path=&quot;slf4j-log4j12-1.7.1.jar&quot; /&gt;
        &lt;resource-root path=&quot;log4j-1.2.15.jar&quot; /&gt;
    &lt;/resources&gt;
    &lt;dependencies&gt;
        &lt;system&gt;
            &lt;paths&gt;
                &lt;path name=&quot;org/xml/sax&quot;/&gt;
                &lt;path name=&quot;org/xml/sax/helpers&quot;/&gt;
                &lt;path name=&quot;javax/net/ssl&quot;/&gt;
                &lt;path name=&quot;javax/xml/parsers&quot;/&gt;
                &lt;path name=&quot;javax/security/auth/spi&quot;/&gt;
                &lt;path name=&quot;javax/security/auth/login&quot;/&gt;
                &lt;path name=&quot;javax/security/auth/callback&quot;/&gt;
                &lt;path name=&quot;javax/security/auth&quot;/&gt;
            &lt;/paths&gt;
        &lt;/system&gt;
    &lt;/dependencies&gt;
&lt;/module&gt;
</code></pre>
<p>For a standard installation, it is not necessary to modify this file.</p>
<p>To configure Bonita Engine for CAS:</p>
<ol>
<li>If you do not already have it, download the Subscription edition deploy zip from the customer portal.</li>
<li>Add the CAS module. To do this, copy <code>BonitaSubscription-x.x.x-deploy/cas-x.x.x-module/org</code> to <code>WILDFLY_HOME/server/modules</code> to merge the CAS module with the existing modules.</li>
<li>Make the CAS module global so that it can be used by any application. To do this, edit <code>WILDFLY_HOME/setup/wildfly-templates/standalone.xml</code> and change the definition of the <code>ee</code> subsystem to the following:</li>
</ol>
<pre><code class="language-xml"> &lt;subsystem xmlns=&quot;urn:jboss:domain:ee:1.0&quot;&gt;
    &lt;global-modules&gt;
        &lt;module name=&quot;org.jasig.cas&quot; slot=&quot;main&quot;/&gt;
     &lt;/global-modules&gt;
&lt;/subsystem&gt;
</code></pre>
<ol start="4">
<li>Edit <code>WILDFLY_HOME/setup/wildfly-templates/standalone.xml</code> and add the BonitaAuthentication module.
Right after the opening <code>&lt;security-domains&gt;</code> tag, insert these lines (specifying the relevant IP addresses and port numbers):</li>
</ol>
<pre><code class="language-xml">&lt;security-domain name=&quot;BonitaAuthentication-1&quot;&gt;
    &lt;authentication&gt;
        &lt;login-module code=&quot;org.jasig.cas.client.jaas.CasLoginModule&quot; flag=&quot;required&quot;&gt;
            &lt;module-option name=&quot;ticketValidatorClass&quot; value=&quot;org.jasig.cas.client.validation.Cas20ServiceTicketValidator&quot;/&gt;
            &lt;module-option name=&quot;casServerUrlPrefix&quot; value=&quot;http://cas_ip_address:cas_port/cas&quot;/&gt;
            &lt;module-option name=&quot;tolerance&quot; value=&quot;20000&quot;/&gt;
            &lt;module-option name=&quot;service&quot; value=&quot;http://cas_ip_address:cas_port/bonita/loginservice&quot;/&gt;
            &lt;module-option name=&quot;defaultRoles&quot; value=&quot;admin,operator&quot;/&gt;
            &lt;module-option name=&quot;roleAttributeNames&quot; value=&quot;memberOf,eduPersonAffiliation&quot;/&gt;
            &lt;module-option name=&quot;principalGroupName&quot; value=&quot;CallerPrincipal&quot;/&gt;
            &lt;module-option name=&quot;roleGroupName&quot; value=&quot;Roles&quot;/&gt;
            &lt;module-option name=&quot;cacheAssertions&quot; value=&quot;true&quot;/&gt;
            &lt;module-option name=&quot;cacheTimeout&quot; value=&quot;480&quot;/&gt;
        &lt;/login-module&gt;
    &lt;/authentication&gt;
&lt;/security-domain&gt;
</code></pre>
<div class="alert alert-warning" role="alert">
<p><strong>Warning</strong>: module names must be unique (from the example above, BonitaAuthentication-1 is the module name). Therefore, remove the unecessary ones</p>
</div>
<ol start="5">
<li>In the <code>CasLoginModule</code> configuration, check that the <code>principalGroupName</code> property is set to <code>CallerPrincipal</code>. This is required to retrieve the username from the Bonita application.
Bonita uses the CAS LoginModule in the JASIG implementation, so see the CAS LoginModule section of the <a href="https://wiki.jasig.org/display/CASC/JAAS+Integration">Jasig documentation</a> for more information.</li>
<li>Update <a href="bonita/7.7/BonitaBPM_platform_setup" ng-click="contentCtrl.goTo($event, 'BonitaBPM_platform_setup')"><code>bonita-tenant-sp-custom.properties</code></a> from <code>setup/platform_conf/initial/tenant_template_engine/</code> if platform has not been initialized yet or <code>setup/platform_conf/current/tenants/[TENANT_ID]/tenant_engine/</code> and <code>setup/platform_conf/current/tenant_template_engine/</code>.</li>
</ol>
<div class="alert alert-info" role="alert">
<p>If the platform has already been initialized, every update to the configuration files under <code>setup/platform_conf/current</code> must be done using the <code>setup</code> tool:</p>
<ul>
<li><code>setup pull</code></li>
<li>edit configuration file(s)</li>
<li><code>setup push</code></li>
</ul>
</div>
<ol>
<li>Remove the comment flags from these lines:
<code>authentication.service.ref.name=jaasAuthenticationService</code></li>
<li>Specify the relevant IP address and port number.</li>
<li><strong>Optionally</strong>, to enable anonymous user to access a process, uncomment this lines:<pre><code>authenticator.delegate=casAuthenticatorDelegate
authentication.delegate.cas.server.url.prefix=http://ip_address:port
authentication.delegate.cas.service.url=http://ip_address:port/bonita/loginservice
</code></pre>
</li>
</ol>
<h2>Configure Bonita Engine and Tomcat for CAS</h2>
<ol>
<li>
<p>The CAS implementation relies on JAAS, and is defined in the BonitaAuthentication module of the JAAS configuration file.<br>
Set the Java system property <code>java.security.auth.login.config</code> in the Tomcat startup script to point to the JAAS configuration file, <a href="bonita/7.7/BonitaBPM_platform_setup" ng-click="contentCtrl.goTo($event, 'BonitaBPM_platform_setup')"><code>TOMCAT_HOME/server/conf/jaas-standard.cfg</code></a>.</p>
<p>For example, on Linux, edit <code>TOMCAT_HOME/setup/tomcat-templates/setenv.sh</code>, uncomment the line that defines <code>SECURITY_OPTS</code>, and insert the variable <code>SECURITY_OPTS</code> in the line <code>CATALINA_OPTS=..</code>.</p>
<p>The <code>TOMCAT_HOME/server/conf/jaas-standard.cfg</code> file contains the following (replace <code>ip_address:port</code> with the relevant IP addresses and port numbers, in two places):</p>
<pre><code>BonitaAuthentication-1 {
  org.jasig.cas.client.jaas.CasLoginModule required
    ticketValidatorClass=&quot;org.jasig.cas.client.validation.Cas20ServiceTicketValidator&quot;
    casServerUrlPrefix=&quot;http://ip_address:port/cas&quot;
    tolerance=&quot;20000&quot;
    service=&quot;http://ip_address:port/bonita/loginservice&quot;
    defaultRoles=&quot;admin,operator&quot;
    roleAttributeNames=&quot;memberOf,eduPersonAffiliation&quot;
    principalGroupName=&quot;CallerPrincipal&quot;
    roleGroupName=&quot;Roles&quot;
    cacheAssertions=&quot;true&quot;
    cacheTimeout=&quot;480&quot;;
};
</code></pre>
<div class="alert alert-warning" role="alert">
<p><strong>Warning</strong>: module names must be unique (from the example above, BonitaAuthentication-1 is the module name). Therefore, remove the unecessary ones</p>
</div>
<p>The JAAS configuration file, <code>jaas-standard.cfg</code>, is sorted by sets of authentication modules. For Bonita, each set matches a tenant configuration and the name is prefixed with <em>BonitaAuthentication-<code>&lt;tenant-id&gt;</code></em>. Make sure there is a set of authentication modules for each tenant in your platform. For each tenant, set the CAS service to point to the application login page and set <code>casServerUrlPrefix</code> to point to the CAS server.</p>
</li>
<li>
<p>In the <code>CasLoginModule</code> configuration, check that the <code>principalGroupName</code> property is set to <code>CallerPrincipal</code>.<br>
This is required to retrieve the username from the Bonita application.
Bonita uses the CAS LoginModule in the JASIG implementation, so see the CAS LoginModule section of the <a href="https://wiki.jasig.org/display/CASC/JAAS+Integration">Jasig documentation</a> for more information.</p>
</li>
<li>
<p>Copy <code>cas-client-core-x.x.x.jar</code> from <code>BonitaSubscription-x.x.x-deploy/cas-x.x.x-module/org/jasig/cas/main</code> into the <code>TOMCAT_HOME/server/lib</code> directory.</p>
</li>
<li>
<p>Copy <code>commons-logging-x.x.x.jar</code> from <code>BonitaSubscription-x.x.x-deploy/BonitaSubscription-x.x.x-LDAP-Synchronizer/BonitaSubscription-x.x.x-LDAP-Synchronizer/lib</code> into the <code>TOMCAT_HOME/server/lib</code> directory.</p>
</li>
<li>
<p>Update <code>bonita-tenant-sp-custom.properties</code> from <code>setup/platform_conf/initial/tenant_template_engine/</code> if platform has not been initialized yet or <code>setup/platform_conf/current/tenants/[TENANT_ID]/tenant_engine/</code> and <code>setup/platform_conf/current/tenant_template_engine/</code>.</p>
</li>
</ol>
<div class="alert alert-info" role="alert">
<p>If the platform has already been initialized, every update to the configuration files under <code>setup/platform_conf/current</code> must be done using the <code>setup</code> tool:</p>
<ul>
<li><code>setup pull</code></li>
<li>edit configuration file(s)</li>
<li><code>setup push</code></li>
</ul>
</div>
<ol>
<li>Remove the comment flags from these lines:
<code>authentication.service.ref.name=jaasAuthenticationService</code></li>
<li><strong>Optionally</strong>, to enable anonymous user to access a process, uncomment this lines:<pre><code>authenticator.delegate=casAuthenticatorDelegate
authentication.delegate.cas.server.url.prefix=http://ip_address:port
authentication.delegate.cas.service.url=http://ip_address:port/bonita/loginservice
</code></pre>
Specify the relevant IP address and port number.</li>
</ol>
<h4>Configure the Bonita Portal for CAS SSO</h4>
<ol>
<li>For each tenant, edit <code>authenticationManager-config.properties</code> to enable the CASRemoteAuthenticationManager and its properties.
Edit the <code>authenticationManager-config.properties</code> located in <code>platform_conf/initial/tenant_template_portal</code> for not initialized platform or <code>platform_conf/current/tenant_template_portal</code> and <code>platform_conf/current/tenants/[TENANT_ID]/tenant_portal/</code>.</li>
</ol>
<div class="alert alert-info" role="alert">
<p>If the platform has already been initialized, every update to the configuration files under <code>setup/platform_conf/current</code> must be done using the <code>setup</code> tool:</p>
<ul>
<li><code>setup pull</code></li>
<li>edit configuration file(s)</li>
<li><code>setup push</code></li>
</ul>
</div>
<p>Make sure that <code>auth.AuthenticationManager</code> property is set to <code>org.bonitasoft.console.common.server.auth.impl.jaas.cas.CASRemoteAuthenticationManagerImpl</code>
Uncomment <code>Cas.serverUrlPrefix</code> and <code>Cas.bonitaServiceURL</code> properties as shown below (specify the relevant IP addresses and ports):</p>
<pre><code>#auth.AuthenticationManager = org.bonitasoft.console.common.server.auth.impl.standard.StandardAuthenticationManagerImplExt
#auth.AuthenticationManager = org.bonitasoft.console.common.server.auth.impl.oauth.OAuthAuthenticationManagerImplExt
# OAuth.serviceProvider = LinkedIn
# OAuth.consumerKey = ove2vcdjptar
# OAuth.consumerSecret = vdaBrCmHvkgJoYz1
# OAuth.callbackURL = http://ip_address:port/loginservice
auth.AuthenticationManager = org.bonitasoft.console.common.server.auth.impl.jaas.cas.CASRemoteAuthenticationManagerImpl
Cas.serverUrlPrefix = http://ip_address:port/cas
Cas.bonitaServiceURL = http://ip_address:port/bonita/portal/homepage
logout.link.hidden=true
</code></pre>
<h4>CAS SSO and Java client application</h4>
<p>To enable a Java client application to access the engine using CAS autentication, the simplest way is to enable <a href="https://apereo.github.io/cas/4.0.x/protocol/REST-Protocol.html">REST authentication on CAS server</a> and have the Java client <a href="bonita/7.7/" ng-click="contentCtrl.goTo($event, '', 'cas-rest-api')">retrieve the <code>ticket</code> for the bonita <code>service</code> URL</a>.<br>
Then, use the <a href="http://documentation.bonitasoft.com/javadoc/api/7.7/org/bonitasoft/engine/api/LoginAPI.html#login(java.util.Map)" target="_self"><code>LoginAPI</code></a> with the <code>java.util.Map</code> having the <code>ticket</code> and <code>service</code>.</p>
<h4>Cluster considerations and bonita webapp for Tomcat</h4>
<p>If you are configuring Bonita and Tomcat in a cluster environment for CAS, there are some extra steps to do:</p>
<ol>
<li>Copy <code>commons-logging-x.x.x.jar</code> from <code>BonitaSubscription-x.x.x-deploy/BonitaSubscription-x.x.x-LDAP-Synchronizer/BonitaSubscription-x.x.x-LDAP-Synchronizer/lib</code> into the <code>TOMCAT_HOME/server/lib</code> directory.</li>
<li>Remove the <code>WEB-INF/lib/commons-logging-x.x.x.jar</code> file from the <code>TOMCAT_HOME/server/webapps/bonita.war</code>.</li>
<li>Remove the <code>TOMCAT_HOME/server/webapps/bonita/WEB-INF/lib/commons-logging-x.x.x.jar</code> file (if it is present).</li>
</ol>
<h3>Troubleshoot</h3>
<p>To troubleshoote SSO login issues, you need to increase the <a href="bonita/7.7/logging" ng-click="contentCtrl.goTo($event, 'logging')">log level</a> to <code>ALL</code> in order for errors to be displayed in the log files (by default, they are not).</p>
<h2>Configure logout behaviour</h2>
<h4>Bonita Portal</h4>
<p>If you are using CAS, when users log out of Bonita Portal, they log out of CAS. Therefore they are logged out of all applications that are using the CAS service. To avoid this, you can hide the logout option of the portal.
To do this, set the <code>logout.link.hidden=true</code> option in <code>authenticationManager-config.properties</code> located in <code>platform_conf/initial/tenant_template_portal</code> for not initialized platform or <code>platform_conf/current/tenant_template_portal</code> and <code>platform_conf/current/tenants/[TENANT_ID]/tenant_portal/</code>.</p>
<div class="alert alert-info" role="alert">
<p>If the platform has already been initialized, every update to the configuration files under <code>setup/platform_conf/current</code> must be done using the <code>setup</code> tool:</p>
<ul>
<li><code>setup pull</code></li>
<li>edit configuration file(s)</li>
<li><code>setup push</code></li>
</ul>
</div>
<p>If this option is set, when users navigate away from the Portal, they are still logged in to CAS.</p>
<h4>Bonita Engine</h4>
<p>By default, logging out from Bonita Engine logs the user out of CAS. You can change this behavior by implementing your own Authentication Service.</p>
<h2>Tenant administrator login</h2>
<p>The <a href="bonita/7.7/tenant_admin_credentials" ng-click="contentCtrl.goTo($event, 'tenant_admin_credentials')">Tenant administrator</a> (also kwown as the <em>tenant technical user</em>) will always be able to log in whitout a CAS account. To log with the tenant administrator, use the standard Bonita Portal login page accessible on <code>http://&lt;bundle host&gt;:&lt;port&gt;/bonita/login.jsp</code>.</p>
<h2>Manage passwords</h2>
<p>When you are using CAS, the password for a user is managed in your CAS system. However, when you create a user in Bonita Portal, specifying a password is mandatory. This password is ignored.</p>
<h2>LDAP synchronizer and CAS</h2>
<p>If you are using an LDAP service and the <a href="bonita/7.7/ldap-synchronizer" ng-click="contentCtrl.goTo($event, 'ldap-synchronizer')">LDAP synchronizer</a> to manage your user data, you can continue to do this and use CAS. The LDAP synchronizer user must be registered in CAS.
Alternatively, the LDAP synchronizer could be run with the tenant technical user, because this bypasses the SSO login.</p>
<p>We recommend that you use LDAP as your master source for information, synchronizing the relevant information with your CAS server.</p>
<a id="cas-rest-api"/>
<h2>Single sign-on with CAS using the REST API</h2>
<p>CAS is a browser-oriented protocol (based on http automatic redirection, cookies, forms, etc...), therefore, we only have securized browser-oriented resources. This is why only a subset of pages are handled to be automatically SSO CAS-verified but not the whole web application.</p>
<a id="restricted_cas_urls"/>
The default `AuthenticationFilter` that manages CAS authentication applies only to the following pages: 
<ul>
<li>/portal</li>
<li>/mobile/*</li>
<li>/portal.js/*</li>
<li>/apps/*</li>
<li>/services/*</li>
</ul>
<p>REST API are not part of them, but if an http session already exists thanks to cookies, REST API can be used.</p>
<p>The recommended way to authenticate to <strong>Bonita Portal</strong> to use the REST API is to use the CAS server REST API.<br>
It allows to retrieve authentication tickets to authenticate to <strong>Bonita Portal</strong>.</p>
<p>For detailed information about the procedure to install Restful access on your CAS SSO server, see the following links:</p>
<ul>
<li><a href="http://apereo.github.io/cas/4.2.x/index.html">CAS SSO RESTful API</a></li>
<li><a href="bonita/7.7/rest-api-overview" ng-click="contentCtrl.goTo($event, 'rest-api-overview')">Bonita REST API</a></li>
</ul>
<div class="alert alert-info" role="alert">
<p><strong>Note:</strong> All calls issued to get the TGT or ST are made to the CAS SSO server.</p>
</div>
<h4>Getting the Ticket Granting Ticket (TGT)</h4>
<p>The Ticket Granting Ticket is an exposed resource. It has a unique URL.</p>
<h5><strong>Request for a Ticket Granting Ticket Resource</strong></h5>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:left"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Request URL</td>
<td style="text-align:left"><code>http://www.your_cas_server_url/cas/v1/tickets</code></td>
</tr>
<tr>
<td style="text-align:left">Request Method</td>
<td style="text-align:left">POST</td>
</tr>
<tr>
<td style="text-align:left">Form Data</td>
<td style="text-align:left">Username: walter.bates  <br/> Password: bpm</td>
</tr>
</tbody>
</table>
<h5><strong>Response for a Ticket Granting Ticket Resource</strong></h5>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:left"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Response</td>
<td style="text-align:left">201 created <br/> <br/><code>Location: http://www.your_cas_server_url/cas/v1/tickets/{TGT}</code></td>
</tr>
</tbody>
</table>
<p>Take the TGT response and paste it in the url of the ST request, below</p>
<h4>Getting the Service Ticket (ST)</h4>
<h5><strong>Request for a Service Ticket</strong></h5>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:left"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Request URL</td>
<td style="text-align:left"><code>http://www.your_cas_server_url/cas/v1/tickets/{TGT}</code></td>
</tr>
<tr>
<td style="text-align:left">Request Method</td>
<td style="text-align:left">POST</td>
</tr>
<tr>
<td style="text-align:left">Form Data</td>
<td style="text-align:left">service={form encoded parameter for the service url}</td>
</tr>
</tbody>
</table>
<p>For instance, in a <strong>Bonita Portal</strong> deployed on Tomcat bundle on a server with IP <code>192.168.1.9</code>, <code>service url</code> can be <code>http://192.168.1.9:8080/bonita/portal/homepage</code>. Its form encoded value would be <code>http%3A%2F%2F192.168.1.9%3A8080%2Fbonita%2Fportal%2Fhomepage</code>.</p>
<h5><strong>Response for a Service (ST)</strong></h5>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:left"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Response</td>
<td style="text-align:left">200 OK <br/> <br/> {ST}</td>
</tr>
</tbody>
</table>
<p>Take the ST response and paste it in the url of the Bonita Engine login request, below</p>
<h4>Logging into Bonita Engine with Rest API using the service ticket</h4>
<p>Use a <strong>Bonita Portal</strong> URL where the <a href="bonita/7.7/" ng-click="contentCtrl.goTo($event, '', 'restricted_cas_urls')">CAS AuthenticationFilter applies</a> for authentication to work.</p>
<div class="alert alert-warning" role="alert">
<p>Prefer GET over POST to authenticate because experience has shown that in some server configuration, POST parameters cannot be retrieved in the CAS authentication web filter.</p>
</div>
<h5><strong>Authentication to Bonita Engine</strong> with GET</h5>
<p>The form encoded parameter URL used as service in the previous step must be used as access point because it will be sent to the CAS server to check ticket validation.</p>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:left"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Request URL</td>
<td style="text-align:left"><code>{service url}</code></td>
</tr>
<tr>
<td style="text-align:left">Request Method</td>
<td style="text-align:left">GET</td>
</tr>
<tr>
<td style="text-align:left">HTTP Params</td>
<td style="text-align:left">ticket={ST}</td>
</tr>
</tbody>
</table>
<h5><strong>Authentication to Bonita Engine</strong> with POST</h5>
<p>Use a Bonita Portal SSO protected URL for this action.</p>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:left"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Request URL</td>
<td style="text-align:left"><code>&lt;bonita portal url&gt;</code></td>
</tr>
<tr>
<td style="text-align:left">Request Method</td>
<td style="text-align:left">POST</td>
</tr>
<tr>
<td style="text-align:left">Form Data</td>
<td style="text-align:left">service={form encoded parameter for the service url}&amp;ticket={ST}</td>
</tr>
</tbody>
</table>
<h5><strong>Response for a Service (ST)</strong></h5>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:left"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Response</td>
<td style="text-align:left">200 OK</td>
</tr>
</tbody>
</table>
<p>You are now logged into Bonita Portal and REST API calls will succeed.</p>
<div class="alert alert-warning" role="alert">
<p>Cookies must be enabled in REST client side for authentication to persist across REST API calls.<br>
Therefore, calling web application root context may not work (e.g. <code>/bonita</code> by default) because session cookie seems not to be set on all web server configurations.
<strong>Use a protected URL to authenticate to Bonita Portal when using the ticket parameter with POST method.</strong></p>
</div>
<!-- Generated on Wed Dec 04 2019 13:25:31 GMT+0100 (Paris, Madrid) -->