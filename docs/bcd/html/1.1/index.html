<div style="position: relative;"><a href="https://github.com/bonitasoft/bonita-continuous-delivery-doc/edit/1.1/md/index.md"><img style="position: absolute; top: -1px; right: -40px; border: 0; z-index=-100;" src="https://camo.githubusercontent.com/365986a132ccd6a44c23a9169022c0b5c890c387/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"/></a></div>
<h1>Bonita Continuous Delivery Add-on</h1>
<p><img src="bcd/images/1.1/bcd.png" alt="Bonita Continuous Delivery Add-on" title="Bonita Continuous Delivery Add-on"></p>
<p>This add-on provides a solution to use <em>Continuous Delivery</em> practice for your Bonita Living Application development and deployment.
It is composed of two main parts:</p>
<ul>
<li>First a solution for Bonita stack provisioning on Cloud or on-premise.</li>
<li>Second a framework for continuous integration of Living Application. <em>This CI framework will be delivered in future versions of the add-on.</em></li>
</ul>
<p>This documentation focus on the first part: the solution and tooling for provisioning of a Bonita stack.
The tool is composed of a set of scripts to deploy a full Bonita stack automatically (database and Bonita Tomcat application server).</p>
<p>This toolkit is compatible with Amazon EC2 cloud platform (AWS), on premises servers and local virtual machines via <a href="https://www.vagrantup.com/">Vagrant</a>.</p>
<p>These scripts are powered by <a href="http://www.ansible.com">Ansible</a>. Short note from Wikipedia:</p>
<div class="alert alert-info" role="alert">
<p>Ansible is a free software platform for configuring and managing computers. It combines multi-node software deployment, ad hoc task execution, and configuration management. It manages nodes over SSH or PowerShell and requires Python (2.4 or later) to be installed on them. Modules work over JSON and standard output and can be written in any programming language. The system uses YAML to express reusable descriptions of systems.</p>
</div>
<p>The Bonita Continuous Delivery (BCD) tooling is provided through a Docker container called <em>BCD Controller</em>. In this controller you’ll find all useful tooling to manage your provisioning of Bonita platform and more. This controller should be installed on your local machine.</p>
<p><img src="bcd/images/1.1/bonita_platform_stack.png" alt="Bonita Provisioning" title="Bonita Provisioning"></p>
<ul>
<li>A “Host” can be an EC2 instance or a dedicated server.</li>
<li>Files organization on the local machine:
<ul>
<li>~/.boto = should contains all credential to your AWS account (if any)</li>
<li>~/bonita-continuous-delivery = used as a work directory for the scripts.</li>
<li>~/.ssh/private_key = used to allow access to hosts</li>
</ul>
</li>
</ul>
<h2>AWS Prerequisites</h2>
<p>In order to be able to deploy on Amazon Web Services please start to read the <a href="?page=aws_prerequisites" ng-click="contentCtrl.goTo($event, 'aws_prerequisites')">AWS Prerequisites section</a>.</p>
<h2>Bonita Licensing Prerequisites</h2>
<p>To use this tool, you must have an active Bonitasoft Subscription and a dedicated access to the license service. please contact your Sales representative for more information.</p>
<p>To automatically retrieve the Bonita licenses for your platforms please take a look at the <a href="?page=licensing_prerequisites" ng-click="contentCtrl.goTo($event, 'licensing_prerequisites')">Licensing Prerequisites section</a>.</p>
<h2>Quickstart</h2>
<p>If you have fulfilled all the prerequisites then you can follow the <a href="?page=quickstart" ng-click="contentCtrl.goTo($event, 'quickstart')">Quickstart guide</a>.</p>
<h2>How to use</h2>
<p>The nominal usage of BCD can de described as the following workflow:</p>
<ul>
<li>(Optional) Amazon EC2 instance creation</li>
<li>Bonita platform deployment in EC2 or on premises</li>
<li>(Optional) Amazon EC2 instance deletion</li>
</ul>
<p>The user must specify the <code>bcd_stack_id</code> variable <strong>for each command</strong> in order to identify its infrastructure. Multiple tests with different <code>bcd_stack_id</code> can be used simultaneously even on AWS. The <code>bcd_stack_id</code> variable should contain only letters, digits or underscore characters (see https://github.com/ansible/ansible/blob/v2.3.1.0-1/contrib/inventory/ec2.py#L1555).</p>
<p>In order to describe a new infrastructure and software configuration (aka. <em>scenario</em>), you need to prepare the following files:</p>
<ul>
<li><strong>scenarios/&lt;scenario_name&gt;.yml</strong>: this YAML file should gather all relevant variables which describe the scenario</li>
<li><strong>inventory/&lt;inventory_file&gt;</strong>: this folder should describe the target infrastructure - Dynamic EC2 inventory is automatically used when provisioning AWS instances.</li>
</ul>
<p>Finally start Bonita stack provisioning by invoking the <code>bcd</code> Command Line Interface (<a href="?page=cli" ng-click="contentCtrl.goTo($event, 'cli')">BCD CLI</a>).</p>
<p>The BCD CLI is directly available as a <code>bcd</code> command when using the BCD Controller Docker image (@see the <a href="?page=quickstart" ng-click="contentCtrl.goTo($event, 'quickstart')">Quickstart guide</a>).</p>
<p>Examples:</p>
<pre><code class="language-shell">$ bcd -s scenarios/uswest_performance.yml create
$ bcd -s scenarios/uswest_performance.yml --yes deploy
$ bcd -s scenarios/uswest_performance.yml destroy --dry-run
$ bcd -s scenarios/vagrant_cluster.yml deploy
$ bcd -s scenarios/vagrant_cluster.yml --yes undeploy
$ bcd -s scenarios/uswest2_cluster.yml -y create deploy
</code></pre>
<h3>EC2 instances creation</h3>
<p>The <code>create_aws.yml</code> playbook goal is to create EC2 instances.</p>
<p>Example: Create 3 x <code>t2.micro</code> EC2 instances</p>
<p>One <code>t2.micro</code> for the database, one for Bonita.</p>
<pre><code class="language-shell">$ bcd -s scenarios/uswest_performance.yml create
</code></pre>
<h3>Deployment and Test</h3>
<h4>Dynamic EC2 Inventory</h4>
<p>Once EC2 instances are created, you can continue with deployment as follows:</p>
<pre><code class="language-shell">$ bcd -s scenarios/uswest_performance.yml deploy
</code></pre>
<p>This command will read the <code>scenarios/uswest_performance.yml</code> configuration file and provision existing EC2 instances accordingly.</p>
<h4>Static On-premises Inventory</h4>
<p>Assuming a server is already up and running (eg. <code>perf-host</code>), you can use these scripts to deploy a Bonita stack on a static infrastructure.</p>
<pre><code class="language-shell">$ bcd -s scenarios/perf-host_cluster.yml deploy
</code></pre>
<p>This command will read the <code>scenarios/perf-host_cluster.yml</code> configuration file and provision an existing server accordingly.</p>
<h4>Vagrant</h4>
<p>We provide 2 sample Vagrant layouts - <code>1-machine</code> and <code>2-machines</code> - which you can find in the <code>vagrant</code> directory.</p>
<ol>
<li>Create the machine infrastructure with <code>vagrant up</code>.</li>
<li>Start provisioning by invoking the <code>bcd</code> CLI.</li>
</ol>
<p>Examples:</p>
<pre><code class="language-shell">$ bcd -s scenarios/vagrant_performance.yml deploy
$ bcd -s scenarios/vagrant_cluster.yml deploy
$ bcd -s scenarios/vagrant_performance.yml -e &quot;bcd_inventory=inventory/vagrant/2-machines/inventory&quot; deploy
# The latter syntax allows to override the bcd_inventory variable from the command line.
</code></pre>
<h3>EC2 Instances Deletion</h3>
<p>The <code>destroy_aws.yml</code> playbook goal is to delete EC2 instances. When tests have finished, you may delete every related EC2 instances like this:</p>
<pre><code class="language-shell">$ bcd -s scenarios/uswest_performance.yml destroy --dry-run
$ bcd -s scenarios/uswest_performance.yml --yes destroy
</code></pre>
<h2>Advanced usage</h2>
<h3>Installing a custom BCD Controller</h3>
<p>In order to setup your own environment without the <a href="?page=docker" ng-click="contentCtrl.goTo($event, 'docker')">BCD Controller Docker image</a>, you can follow the installation procedure described in its Dockerfile.</p>
<p>The BCD controller Dockerfile is provided with BCD deliverable in the <code>bonita-continuous-delivery_&lt;version&gt;/docker</code> directory.</p>
<h3>Debugging Facts</h3>
<p>Ansible facts are local variables registered in hosts. It is possible to save them in JSON files with the <code>setup</code> command.</p>
<pre><code>$ ansible all -vv -i inventory/ec2/ec2_wrapper.sh -m setup -u ubuntu --tree tmp_facts/
</code></pre>
<p>This command will identify every EC2 instance (regardless of <code>bcd_stack_id</code>) and put its facts into the <code>tmp_facts</code> directory.</p>
<h3>Dive into the scenarios</h3>
<p>For further details see <a href="?page=scenarios" ng-click="contentCtrl.goTo($event, 'scenarios')">this section</a>.</p>
<h2>Known issues</h2>
<p>For further details see <a href="?page=known_issues" ng-click="contentCtrl.goTo($event, 'known_issues')">this section</a>.</p>
<!-- Generated on Wed Jan 31 2018 10:22:57 GMT+0100 (Paris, Madrid) -->